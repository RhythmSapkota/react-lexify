"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const T=require("./styles-9a916d00-CTBrwytW.js"),d=require("./index-CvlpYZ1D.js"),$=require("./graph-L5sQI78Q.js"),H=require("./layout-ChCyWgcE.js");require("./index-B68OGEr0.js");const _=require("./line-fE3iCZvo.js");let S=0;const C=function(i,r,t,l,p){const c=function(e){switch(e){case p.db.relationType.AGGREGATION:return"aggregation";case p.db.relationType.EXTENSION:return"extension";case p.db.relationType.COMPOSITION:return"composition";case p.db.relationType.DEPENDENCY:return"dependency";case p.db.relationType.LOLLIPOP:return"lollipop"}};r.points=r.points.filter(e=>!Number.isNaN(e.y));const o=r.points,h=_.line().x(function(e){return e.x}).y(function(e){return e.y}).curve(d.curveBasis),n=i.append("path").attr("d",h(o)).attr("id","edge"+S).attr("class","relation");let a="";l.arrowMarkerAbsolute&&(a=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,a=a.replace(/\(/g,"\\("),a=a.replace(/\)/g,"\\)")),t.relation.lineType==1&&n.attr("class","relation dashed-line"),t.relation.lineType==10&&n.attr("class","relation dotted-line"),t.relation.type1!=="none"&&n.attr("marker-start","url("+a+"#"+c(t.relation.type1)+"Start)"),t.relation.type2!=="none"&&n.attr("marker-end","url("+a+"#"+c(t.relation.type2)+"End)");let f,u;const x=r.points.length;let w=d.utils.calcLabelPosition(r.points);f=w.x,u=w.y;let y,b,m,k;if(x%2!==0&&x>1){let e=d.utils.calcCardinalityPosition(t.relation.type1!=="none",r.points,r.points[0]),s=d.utils.calcCardinalityPosition(t.relation.type2!=="none",r.points,r.points[x-1]);d.log$1.debug("cardinality_1_point "+JSON.stringify(e)),d.log$1.debug("cardinality_2_point "+JSON.stringify(s)),y=e.x,b=e.y,m=s.x,k=s.y}if(t.title!==void 0){const e=i.append("g").attr("class","classLabel"),s=e.append("text").attr("class","label").attr("x",f).attr("y",u).attr("fill","red").attr("text-anchor","middle").text(t.title);window.label=s;const g=s.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",g.x-l.padding/2).attr("y",g.y-l.padding/2).attr("width",g.width+l.padding).attr("height",g.height+l.padding)}d.log$1.info("Rendering relation "+JSON.stringify(t)),t.relationTitle1!==void 0&&t.relationTitle1!=="none"&&i.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",y).attr("y",b).attr("fill","black").attr("font-size","6").text(t.relationTitle1),t.relationTitle2!==void 0&&t.relationTitle2!=="none"&&i.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",m).attr("y",k).attr("fill","black").attr("font-size","6").text(t.relationTitle2),S++},A=function(i,r,t,l){d.log$1.debug("Rendering class ",r,t);const p=r.id,c={id:p,label:r.id,width:0,height:0},o=i.append("g").attr("id",l.db.lookUpDomId(p)).attr("class","classGroup");let h;r.link?h=o.append("svg:a").attr("xlink:href",r.link).attr("target",r.linkTarget).append("text").attr("y",t.textHeight+t.padding).attr("x",0):h=o.append("text").attr("y",t.textHeight+t.padding).attr("x",0);let n=!0;r.annotations.forEach(function(s){const g=h.append("tspan").text("«"+s+"»");n||g.attr("dy",t.textHeight),n=!1});let a=v(r);const f=h.append("tspan").text(a).attr("class","title");n||f.attr("dy",t.textHeight);const u=h.node().getBBox().height;let x,w,y;if(r.members.length>0){x=o.append("line").attr("x1",0).attr("y1",t.padding+u+t.dividerMargin/2).attr("y2",t.padding+u+t.dividerMargin/2);const s=o.append("text").attr("x",t.padding).attr("y",u+t.dividerMargin+t.textHeight).attr("fill","white").attr("class","classText");n=!0,r.members.forEach(function(g){N(s,g,n,t),n=!1}),w=s.node().getBBox()}if(r.methods.length>0){y=o.append("line").attr("x1",0).attr("y1",t.padding+u+t.dividerMargin+w.height).attr("y2",t.padding+u+t.dividerMargin+w.height);const s=o.append("text").attr("x",t.padding).attr("y",u+2*t.dividerMargin+w.height+t.textHeight).attr("fill","white").attr("class","classText");n=!0,r.methods.forEach(function(g){N(s,g,n,t),n=!1})}const b=o.node().getBBox();var m=" ";r.cssClasses.length>0&&(m=m+r.cssClasses.join(" "));const e=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",b.width+2*t.padding).attr("height",b.height+t.padding+.5*t.dividerMargin).attr("class",m).node().getBBox().width;return h.node().childNodes.forEach(function(s){s.setAttribute("x",(e-s.getBBox().width)/2)}),r.tooltip&&h.insert("title").text(r.tooltip),x&&x.attr("x2",e),y&&y.attr("x2",e),c.width=e,c.height=b.height+t.padding+.5*t.dividerMargin,c},v=function(i){let r=i.id;return i.type&&(r+="<"+d.parseGenericTypes(i.type)+">"),r},W=function(i,r,t,l){d.log$1.debug("Rendering note ",r,t);const p=r.id,c={id:p,text:r.text,width:0,height:0},o=i.append("g").attr("id",p).attr("class","classGroup");let h=o.append("text").attr("y",t.textHeight+t.padding).attr("x",0);const n=JSON.parse(`"${r.text}"`).split(`
`);n.forEach(function(x){d.log$1.debug(`Adding line: ${x}`),h.append("tspan").text(x).attr("class","title").attr("dy",t.textHeight)});const a=o.node().getBBox(),u=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",a.width+2*t.padding).attr("height",a.height+n.length*t.textHeight+t.padding+.5*t.dividerMargin).node().getBBox().width;return h.node().childNodes.forEach(function(x){x.setAttribute("x",(u-x.getBBox().width)/2)}),c.width=u,c.height=a.height+n.length*t.textHeight+t.padding+.5*t.dividerMargin,c},N=function(i,r,t,l){const{displayText:p,cssStyle:c}=r.getDisplayDetails(),o=i.append("tspan").attr("x",l.padding).text(p);c!==""&&o.attr("style",r.cssStyle),t||o.attr("dy",l.textHeight)},M={getClassTitleString:v,drawClass:A,drawEdge:C,drawNote:W};let B={};const E=20,L=function(i){const r=Object.entries(B).find(t=>t[1].label===i);if(r)return r[0]},G=function(i){i.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),i.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),i.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),i.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),i.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),i.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),i.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),i.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},I=function(i,r,t,l){const p=d.getConfig().class;B={},d.log$1.info("Rendering diagram "+i);const c=d.getConfig().securityLevel;let o;c==="sandbox"&&(o=d.select("#i"+r));const h=c==="sandbox"?d.select(o.nodes()[0].contentDocument.body):d.select("body"),n=h.select(`[id='${r}']`);G(n);const a=new $.Graph({multigraph:!0});a.setGraph({isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const f=l.db.getClasses(),u=Object.keys(f);for(const e of u){const s=f[e],g=M.drawClass(n,s,p,l);B[g.id]=g,a.setNode(g.id,g),d.log$1.info("Org height: "+g.height)}l.db.getRelations().forEach(function(e){d.log$1.info("tjoho"+L(e.id1)+L(e.id2)+JSON.stringify(e)),a.setEdge(L(e.id1),L(e.id2),{relation:e},e.title||"DEFAULT")}),l.db.getNotes().forEach(function(e){d.log$1.debug(`Adding note: ${JSON.stringify(e)}`);const s=M.drawNote(n,e,p,l);B[s.id]=s,a.setNode(s.id,s),e.class&&e.class in f&&a.setEdge(e.id,L(e.class),{relation:{id1:e.id,id2:e.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")}),H.layout(a),a.nodes().forEach(function(e){e!==void 0&&a.node(e)!==void 0&&(d.log$1.debug("Node "+e+": "+JSON.stringify(a.node(e))),h.select("#"+(l.db.lookUpDomId(e)||e)).attr("transform","translate("+(a.node(e).x-a.node(e).width/2)+","+(a.node(e).y-a.node(e).height/2)+" )"))}),a.edges().forEach(function(e){e!==void 0&&a.edge(e)!==void 0&&(d.log$1.debug("Edge "+e.v+" -> "+e.w+": "+JSON.stringify(a.edge(e))),M.drawEdge(n,a.edge(e),a.edge(e).relation,p,l))});const y=n.node().getBBox(),b=y.width+E*2,m=y.height+E*2;d.configureSvgSize(n,m,b,p.useMaxWidth);const k=`${y.x-E} ${y.y-E} ${b} ${m}`;d.log$1.debug(`viewBox ${k}`),n.attr("viewBox",k)},O={draw:I},P={parser:T.parser$1,db:T.db,renderer:O,styles:T.styles,init:i=>{i.class||(i.class={}),i.class.arrowMarkerAbsolute=i.arrowMarkerAbsolute,T.db.clear()}};exports.diagram=P;
//# sourceMappingURL=classDiagram-70f12bd4-C3RyrBxF.js.map
