{"version":3,"file":"image-blob-reduce.esm-BkjLmknz.mjs","sources":["../node_modules/image-blob-reduce/dist/image-blob-reduce.esm.mjs"],"sourcesContent":["\n/*! image-blob-reduce 3.0.1 https://github.com/nodeca/image-blob-reduce @license MIT */\nvar assign$1 = function assign(to) {\n  var from;\n\n  for (var s = 1; s < arguments.length; s++) {\n    from = Object(arguments[s]);\n\n    for (var key in from) {\n      if (Object.prototype.hasOwnProperty.call(from, key)) to[key] = from[key];\n    }\n  }\n\n  return to;\n};\n\n\nfunction pick(from, props) {\n  var to = {};\n\n  props.forEach(function (key) {\n    if (Object.prototype.hasOwnProperty.call(from, key)) to[key] = from[key];\n  });\n\n  return to;\n}\n\n\nfunction pick_pica_resize_options(from) {\n  return pick(from, [\n    'alpha',\n    'unsharpAmount',\n    'unsharpRadius',\n    'unsharpThreshold',\n    'cancelToken'\n  ]);\n}\n\n\nvar pick_1 = pick;\nvar pick_pica_resize_options_1 = pick_pica_resize_options;\n\nvar utils = {\n\tassign: assign$1,\n\tpick: pick_1,\n\tpick_pica_resize_options: pick_pica_resize_options_1\n};\n\nfunction createCommonjsModule(fn) {\n  var module = { exports: {} };\n\treturn fn(module, module.exports), module.exports;\n}\n\nfunction commonjsRequire (target) {\n\tthrow new Error('Could not dynamically require \"' + target + '\". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.');\n}\n\n/*!\n\npica\nhttps://github.com/nodeca/pica\n\n*/\n\nvar pica = createCommonjsModule(function (module, exports) {\n(function(f){{module.exports=f();}})(function(){return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof commonjsRequire&&commonjsRequire;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t);}return n[i].exports}for(var u=\"function\"==typeof commonjsRequire&&commonjsRequire,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(_dereq_,module,exports){\n\nvar inherits = _dereq_('inherits');\n\nvar Multimath = _dereq_('multimath');\n\nvar mm_unsharp_mask = _dereq_('./mm_unsharp_mask');\n\nvar mm_resize = _dereq_('./mm_resize');\n\nfunction MathLib(requested_features) {\n  var __requested_features = requested_features || [];\n\n  var features = {\n    js: __requested_features.indexOf('js') >= 0,\n    wasm: __requested_features.indexOf('wasm') >= 0\n  };\n  Multimath.call(this, features);\n  this.features = {\n    js: features.js,\n    wasm: features.wasm && this.has_wasm()\n  };\n  this.use(mm_unsharp_mask);\n  this.use(mm_resize);\n}\n\ninherits(MathLib, Multimath);\n\nMathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n  var result = this.resize(options, cache);\n\n  if (options.unsharpAmount) {\n    this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n  }\n\n  return result;\n};\n\nmodule.exports = MathLib;\n\n},{\"./mm_resize\":4,\"./mm_unsharp_mask\":9,\"inherits\":19,\"multimath\":20}],2:[function(_dereq_,module,exports){\n//var FIXED_FRAC_BITS = 14;\n\nfunction clampTo8(i) {\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n} // Convolve image in horizontal directions and transpose output. In theory,\n// transpose allow:\n//\n// - use the same convolver for both passes (this fails due different\n//   types of input array and temporary buffer)\n// - making vertical pass by horisonltal lines inprove CPU cache use.\n//\n// But in real life this doesn't work :)\n//\n\n\nfunction convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n} // Technically, convolvers are the same. But input array and temporary\n// buffer can be of different type (especially, in old browsers). So,\n// keep code in separate functions to avoid deoptimizations & speed loss.\n\n\nfunction convolveVertically(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\nmodule.exports = {\n  convolveHorizontally: convolveHorizontally,\n  convolveVertically: convolveVertically\n};\n\n},{}],3:[function(_dereq_,module,exports){\n/* eslint-disable max-len */\n\nmodule.exports = 'AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs=';\n\n},{}],4:[function(_dereq_,module,exports){\n\nmodule.exports = {\n  name: 'resize',\n  fn: _dereq_('./resize'),\n  wasm_fn: _dereq_('./resize_wasm'),\n  wasm_src: _dereq_('./convolve_wasm_base64')\n};\n\n},{\"./convolve_wasm_base64\":3,\"./resize\":5,\"./resize_wasm\":8}],5:[function(_dereq_,module,exports){\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nvar convolveHorizontally = _dereq_('./convolve').convolveHorizontally;\n\nvar convolveVertically = _dereq_('./convolve').convolveVertically;\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nmodule.exports = function resize(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0;\n  var offsetY = options.offsetY || 0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n  var tmp = new Uint8Array(destW * srcH * 4); // To use single function we need src & tmp of the same type.\n  // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n  // vertical and horizontal passes separately to avoid deoptimization.\n\n  convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n  convolveVertically(tmp, dest, srcH, destW, destH, filtersY); // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n  return dest;\n};\n\n},{\"./convolve\":2,\"./resize_filter_gen\":6}],6:[function(_dereq_,module,exports){\n\nvar FILTER_INFO = _dereq_('./resize_filter_info'); // Precision of fixed FP values\n\n\nvar FIXED_FRAC_BITS = 14;\n\nfunction toFixedPoint(num) {\n  return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n}\n\nmodule.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n  var filterFunction = FILTER_INFO[quality].filter;\n  var scaleInverted = 1.0 / scale;\n  var scaleClamped = Math.min(1.0, scale); // For upscale\n  // Filter window (averaging interval), scaled to src image\n\n  var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n  var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n  var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n  var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n  var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n  var packedFilterPtr = 0;\n  var slowCopy = !packedFilter.subarray || !packedFilter.set; // For each destination pixel calculate source range and built filter values\n\n  for (destPixel = 0; destPixel < destSize; destPixel++) {\n    // Scaling should be done relative to central pixel point\n    srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n    srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n    srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n    filterElementSize = srcLast - srcFirst + 1;\n    floatFilter = new Float32Array(filterElementSize);\n    fxpFilter = new Int16Array(filterElementSize);\n    total = 0.0; // Fill filter values for calculated range\n\n    for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n      floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n      total += floatVal;\n      floatFilter[idx] = floatVal;\n    } // Normalize filter, convert to fixed point and accumulate conversion error\n\n\n    filterTotal = 0;\n\n    for (idx = 0; idx < floatFilter.length; idx++) {\n      filterVal = floatFilter[idx] / total;\n      filterTotal += filterVal;\n      fxpFilter[idx] = toFixedPoint(filterVal);\n    } // Compensate normalization error, to minimize brightness drift\n\n\n    fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal); //\n    // Now pack filter to useable form\n    //\n    // 1. Trim heading and tailing zero values, and compensate shitf/length\n    // 2. Put all to single array in this format:\n    //\n    //    [ pos shift, data length, value1, value2, value3, ... ]\n    //\n\n    leftNotEmpty = 0;\n\n    while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n      leftNotEmpty++;\n    }\n\n    if (leftNotEmpty < fxpFilter.length) {\n      rightNotEmpty = fxpFilter.length - 1;\n\n      while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n        rightNotEmpty--;\n      }\n\n      filterShift = srcFirst + leftNotEmpty;\n      filterSize = rightNotEmpty - leftNotEmpty + 1;\n      packedFilter[packedFilterPtr++] = filterShift; // shift\n\n      packedFilter[packedFilterPtr++] = filterSize; // size\n\n      if (!slowCopy) {\n        packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n        packedFilterPtr += filterSize;\n      } else {\n        // fallback for old IE < 11, without subarray/set methods\n        for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n          packedFilter[packedFilterPtr++] = fxpFilter[idx];\n        }\n      }\n    } else {\n      // zero data, write header only\n      packedFilter[packedFilterPtr++] = 0; // shift\n\n      packedFilter[packedFilterPtr++] = 0; // size\n    }\n  }\n\n  return packedFilter;\n};\n\n},{\"./resize_filter_info\":7}],7:[function(_dereq_,module,exports){\n\nmodule.exports = [{\n  // Nearest neibor (Box)\n  win: 0.5,\n  filter: function filter(x) {\n    return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n  }\n}, {\n  // Hamming\n  win: 1.0,\n  filter: function filter(x) {\n    if (x <= -1.0 || x >= 1.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n  }\n}, {\n  // Lanczos, win = 2\n  win: 2.0,\n  filter: function filter(x) {\n    if (x <= -2.0 || x >= 2.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n  }\n}, {\n  // Lanczos, win = 3\n  win: 3.0,\n  filter: function filter(x) {\n    if (x <= -3.0 || x >= 3.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n  }\n}];\n\n},{}],8:[function(_dereq_,module,exports){\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nfunction asUint8Array(src) {\n  return new Uint8Array(src.buffer, 0, src.byteLength);\n}\n\nvar IS_LE = true; // should not crash everything on module load in old browsers\n\ntry {\n  IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n} catch (__) {}\n\nfunction copyInt16asLE(src, target, target_offset) {\n  if (IS_LE) {\n    target.set(asUint8Array(src), target_offset);\n    return;\n  }\n\n  for (var ptr = target_offset, i = 0; i < src.length; i++) {\n    var data = src[i];\n    target[ptr++] = data & 0xFF;\n    target[ptr++] = data >> 8 & 0xFF;\n  }\n}\n\nmodule.exports = function resize_wasm(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0.0;\n  var offsetY = options.offsetY || 0.0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY); // destination is 0 too.\n\n  var src_offset = 0; // buffer between convolve passes\n\n  var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n\n  var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n\n  var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n\n  var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n  var instance = this.__instance('resize', alloc_bytes); //\n  // Fill memory block with data to process\n  //\n\n\n  var mem = new Uint8Array(this.__memory.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer); // 32-bit copy is much faster in chrome\n\n  var src32 = new Uint32Array(src.buffer);\n  mem32.set(src32); // We should guarantee LE bytes order. Filters are not big, so\n  // speed difference is not significant vs direct .set()\n\n  copyInt16asLE(filtersX, mem, filtersX_offset);\n  copyInt16asLE(filtersY, mem, filtersY_offset); //\n  // Now call webassembly method\n  // emsdk does method names with '_'\n\n  var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n  fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH); //\n  // Copy data back to typed array\n  //\n  // 32-bit copy is much faster in chrome\n\n  var dest32 = new Uint32Array(dest.buffer);\n  dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW)); // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n  return dest;\n};\n\n},{\"./resize_filter_gen\":6}],9:[function(_dereq_,module,exports){\n\nmodule.exports = {\n  name: 'unsharp_mask',\n  fn: _dereq_('./unsharp_mask'),\n  wasm_fn: _dereq_('./unsharp_mask_wasm'),\n  wasm_src: _dereq_('./unsharp_mask_wasm_base64')\n};\n\n},{\"./unsharp_mask\":10,\"./unsharp_mask_wasm\":11,\"./unsharp_mask_wasm_base64\":12}],10:[function(_dereq_,module,exports){\n\nvar glur_mono16 = _dereq_('glur/mono16');\n\nfunction hsv_v16(img, width, height) {\n  var size = width * height;\n  var out = new Uint16Array(size);\n  var r, g, b, max;\n\n  for (var i = 0; i < size; i++) {\n    r = img[4 * i];\n    g = img[4 * i + 1];\n    b = img[4 * i + 2];\n    max = r >= g && r >= b ? r : g >= b && g >= r ? g : b;\n    out[i] = max << 8;\n  }\n\n  return out;\n}\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  var v1, v2, vmul;\n  var diff, iTimes4;\n\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var brightness = hsv_v16(img, width, height);\n  var blured = new Uint16Array(brightness); // copy, because blur modify src\n\n  glur_mono16(blured, width, height, radius);\n  var amountFp = amount / 100 * 0x1000 + 0.5 | 0;\n  var thresholdFp = threshold << 8;\n  var size = width * height;\n  /* eslint-disable indent */\n\n  for (var i = 0; i < size; i++) {\n    v1 = brightness[i];\n    diff = v1 - blured[i];\n\n    if (Math.abs(diff) >= thresholdFp) {\n      // add unsharp mask to the brightness channel\n      v2 = v1 + (amountFp * diff + 0x800 >> 12); // Both v1 and v2 are within [0.0 .. 255.0] (0000-FF00) range, never going into\n      // [255.003 .. 255.996] (FF01-FFFF). This allows to round this value as (x+.5)|0\n      // later without overflowing.\n\n      v2 = v2 > 0xff00 ? 0xff00 : v2;\n      v2 = v2 < 0x0000 ? 0x0000 : v2; // Avoid division by 0. V=0 means rgb(0,0,0), unsharp with unsharpAmount>0 cannot\n      // change this value (because diff between colors gets inflated), so no need to verify correctness.\n\n      v1 = v1 !== 0 ? v1 : 1; // Multiplying V in HSV model by a constant is equivalent to multiplying each component\n      // in RGB by the same constant (same for HSL), see also:\n      // https://beesbuzz.biz/code/16-hsv-color-transforms\n\n      vmul = (v2 << 12) / v1 | 0; // Result will be in [0..255] range because:\n      //  - all numbers are positive\n      //  - r,g,b <= (v1/256)\n      //  - r,g,b,(v1/256),(v2/256) <= 255\n      // So highest this number can get is X*255/X+0.5=255.5 which is < 256 and rounds down.\n\n      iTimes4 = i * 4;\n      img[iTimes4] = img[iTimes4] * vmul + 0x800 >> 12; // R\n\n      img[iTimes4 + 1] = img[iTimes4 + 1] * vmul + 0x800 >> 12; // G\n\n      img[iTimes4 + 2] = img[iTimes4 + 2] * vmul + 0x800 >> 12; // B\n    }\n  }\n};\n\n},{\"glur/mono16\":18}],11:[function(_dereq_,module,exports){\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var pixels = width * height;\n  var img_bytes_cnt = pixels * 4;\n  var hsv_bytes_cnt = pixels * 2;\n  var blur_bytes_cnt = pixels * 2;\n  var blur_line_byte_cnt = Math.max(width, height) * 4; // float32 array\n\n  var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n  var img_offset = 0;\n  var hsv_offset = img_bytes_cnt;\n  var blur_offset = hsv_offset + hsv_bytes_cnt;\n  var blur_tmp_offset = blur_offset + blur_bytes_cnt;\n  var blur_line_offset = blur_tmp_offset + blur_bytes_cnt;\n  var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n  var instance = this.__instance('unsharp_mask', img_bytes_cnt + hsv_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt, {\n    exp: Math.exp\n  }); // 32-bit copy is much faster in chrome\n\n\n  var img32 = new Uint32Array(img.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n  mem32.set(img32); // HSL\n\n  var fn = instance.exports.hsv_v16 || instance.exports._hsv_v16;\n  fn(img_offset, hsv_offset, width, height); // BLUR\n\n  fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n  fn(hsv_offset, blur_offset, blur_tmp_offset, blur_line_offset, blur_coeffs_offset, width, height, radius); // UNSHARP\n\n  fn = instance.exports.unsharp || instance.exports._unsharp;\n  fn(img_offset, img_offset, hsv_offset, blur_offset, width, height, amount, threshold); // 32-bit copy is much faster in chrome\n\n  img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n};\n\n},{}],12:[function(_dereq_,module,exports){\n/* eslint-disable max-len */\n\nmodule.exports = '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';\n\n},{}],13:[function(_dereq_,module,exports){\n\nvar GC_INTERVAL = 100;\n\nfunction Pool(create, idle) {\n  this.create = create;\n  this.available = [];\n  this.acquired = {};\n  this.lastId = 1;\n  this.timeoutId = 0;\n  this.idle = idle || 2000;\n}\n\nPool.prototype.acquire = function () {\n  var _this = this;\n\n  var resource;\n\n  if (this.available.length !== 0) {\n    resource = this.available.pop();\n  } else {\n    resource = this.create();\n    resource.id = this.lastId++;\n\n    resource.release = function () {\n      return _this.release(resource);\n    };\n  }\n\n  this.acquired[resource.id] = resource;\n  return resource;\n};\n\nPool.prototype.release = function (resource) {\n  var _this2 = this;\n\n  delete this.acquired[resource.id];\n  resource.lastUsed = Date.now();\n  this.available.push(resource);\n\n  if (this.timeoutId === 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this2.gc();\n    }, GC_INTERVAL);\n  }\n};\n\nPool.prototype.gc = function () {\n  var _this3 = this;\n\n  var now = Date.now();\n  this.available = this.available.filter(function (resource) {\n    if (now - resource.lastUsed > _this3.idle) {\n      resource.destroy();\n      return false;\n    }\n\n    return true;\n  });\n\n  if (this.available.length !== 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this3.gc();\n    }, GC_INTERVAL);\n  } else {\n    this.timeoutId = 0;\n  }\n};\n\nmodule.exports = Pool;\n\n},{}],14:[function(_dereq_,module,exports){\n// min size = 1 can consume large amount of memory\n\nvar MIN_INNER_TILE_SIZE = 2;\n\nmodule.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n  var scaleX = toWidth / fromWidth;\n  var scaleY = toHeight / fromHeight; // derived from createRegions equation:\n  // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n\n  var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize; // refuse to scale image multiple times by less than twice each time,\n  // it could only happen because of invalid options\n\n  if (minScale > 0.5) return [[toWidth, toHeight]];\n  var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale)); // no additional resizes are necessary,\n  // stageCount can be zero or be negative when enlarging the image\n\n  if (stageCount <= 1) return [[toWidth, toHeight]];\n  var result = [];\n\n  for (var i = 0; i < stageCount; i++) {\n    var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n    var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n    result.push([width, height]);\n  }\n\n  return result;\n};\n\n},{}],15:[function(_dereq_,module,exports){\n/*\n * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n * functions which take into account floating point arithmetic errors.\n * Those errors can cause undesired increments/decrements of sizes and offsets:\n * Math.ceil(36 / (36 / 500)) = 501\n * pixelCeil(36 / (36 / 500)) = 500\n */\n\nvar PIXEL_EPSILON = 1e-5;\n\nfunction pixelFloor(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.floor(x);\n}\n\nfunction pixelCeil(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.ceil(x);\n}\n\nmodule.exports = function createRegions(options) {\n  var scaleX = options.toWidth / options.width;\n  var scaleY = options.toHeight / options.height;\n  var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n  var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder; // prevent infinite loop, this should never happen\n\n  if (innerTileWidth < 1 || innerTileHeight < 1) {\n    throw new Error('Internal error in pica: target tile width/height is too small.');\n  }\n\n  var x, y;\n  var innerX, innerY, toTileWidth, toTileHeight;\n  var tiles = [];\n  var tile; // we go top-to-down instead of left-to-right to make image displayed from top to\n  // doesn in the browser\n\n  for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n    for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n      x = innerX - options.destTileBorder;\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n\n      if (x + toTileWidth >= options.toWidth) {\n        toTileWidth = options.toWidth - x;\n      }\n\n      y = innerY - options.destTileBorder;\n\n      if (y < 0) {\n        y = 0;\n      }\n\n      toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n\n      if (y + toTileHeight >= options.toHeight) {\n        toTileHeight = options.toHeight - y;\n      }\n\n      tile = {\n        toX: x,\n        toY: y,\n        toWidth: toTileWidth,\n        toHeight: toTileHeight,\n        toInnerX: innerX,\n        toInnerY: innerY,\n        toInnerWidth: innerTileWidth,\n        toInnerHeight: innerTileHeight,\n        offsetX: x / scaleX - pixelFloor(x / scaleX),\n        offsetY: y / scaleY - pixelFloor(y / scaleY),\n        scaleX: scaleX,\n        scaleY: scaleY,\n        x: pixelFloor(x / scaleX),\n        y: pixelFloor(y / scaleY),\n        width: pixelCeil(toTileWidth / scaleX),\n        height: pixelCeil(toTileHeight / scaleY)\n      };\n      tiles.push(tile);\n    }\n  }\n\n  return tiles;\n};\n\n},{}],16:[function(_dereq_,module,exports){\n\nfunction objClass(obj) {\n  return Object.prototype.toString.call(obj);\n}\n\nmodule.exports.isCanvas = function isCanvas(element) {\n  var cname = objClass(element);\n  return cname === '[object HTMLCanvasElement]'\n  /* browser */\n  || cname === '[object OffscreenCanvas]' || cname === '[object Canvas]'\n  /* node-canvas */\n  ;\n};\n\nmodule.exports.isImage = function isImage(element) {\n  return objClass(element) === '[object HTMLImageElement]';\n};\n\nmodule.exports.isImageBitmap = function isImageBitmap(element) {\n  return objClass(element) === '[object ImageBitmap]';\n};\n\nmodule.exports.limiter = function limiter(concurrency) {\n  var active = 0,\n      queue = [];\n\n  function roll() {\n    if (active < concurrency && queue.length) {\n      active++;\n      queue.shift()();\n    }\n  }\n\n  return function limit(fn) {\n    return new Promise(function (resolve, reject) {\n      queue.push(function () {\n        fn().then(function (result) {\n          resolve(result);\n          active--;\n          roll();\n        }, function (err) {\n          reject(err);\n          active--;\n          roll();\n        });\n      });\n      roll();\n    });\n  };\n};\n\nmodule.exports.cib_quality_name = function cib_quality_name(num) {\n  switch (num) {\n    case 0:\n      return 'pixelated';\n\n    case 1:\n      return 'low';\n\n    case 2:\n      return 'medium';\n  }\n\n  return 'high';\n};\n\nmodule.exports.cib_support = function cib_support(createCanvas) {\n  return Promise.resolve().then(function () {\n    if (typeof createImageBitmap === 'undefined') {\n      return false;\n    }\n\n    var c = createCanvas(100, 100);\n    return createImageBitmap(c, 0, 0, 100, 100, {\n      resizeWidth: 10,\n      resizeHeight: 10,\n      resizeQuality: 'high'\n    }).then(function (bitmap) {\n      var status = bitmap.width === 10; // Branch below is filtered on upper level. We do not call resize\n      // detection for basic ImageBitmap.\n      //\n      // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n      // old Crome 51 has ImageBitmap without .close(). Then this code\n      // will throw and return 'false' as expected.\n      //\n\n      bitmap.close();\n      c = null;\n      return status;\n    });\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nmodule.exports.worker_offscreen_canvas_support = function worker_offscreen_canvas_support() {\n  return new Promise(function (resolve, reject) {\n    if (typeof OffscreenCanvas === 'undefined') {\n      // if OffscreenCanvas is present, we assume browser supports Worker and built-in Promise as well\n      resolve(false);\n      return;\n    }\n\n    function workerPayload(self) {\n      if (typeof createImageBitmap === 'undefined') {\n        self.postMessage(false);\n        return;\n      }\n\n      Promise.resolve().then(function () {\n        var canvas = new OffscreenCanvas(10, 10); // test that 2d context can be used in worker\n\n        var ctx = canvas.getContext('2d');\n        ctx.rect(0, 0, 1, 1); // test that cib can be used to return image bitmap from worker\n\n        return createImageBitmap(canvas, 0, 0, 1, 1);\n      }).then(function () {\n        return self.postMessage(true);\n      }, function () {\n        return self.postMessage(false);\n      });\n    }\n\n    var code = btoa(\"(\".concat(workerPayload.toString(), \")(self);\"));\n    var w = new Worker(\"data:text/javascript;base64,\".concat(code));\n\n    w.onmessage = function (ev) {\n      return resolve(ev.data);\n    };\n\n    w.onerror = reject;\n  }).then(function (result) {\n    return result;\n  }, function () {\n    return false;\n  });\n}; // Check if canvas.getContext('2d').getImageData can be used,\n// FireFox randomizes the output of that function in `privacy.resistFingerprinting` mode\n\n\nmodule.exports.can_use_canvas = function can_use_canvas(createCanvas) {\n  var usable = false;\n\n  try {\n    var canvas = createCanvas(2, 1);\n    var ctx = canvas.getContext('2d');\n    var d = ctx.createImageData(2, 1);\n    d.data[0] = 12;\n    d.data[1] = 23;\n    d.data[2] = 34;\n    d.data[3] = 255;\n    d.data[4] = 45;\n    d.data[5] = 56;\n    d.data[6] = 67;\n    d.data[7] = 255;\n    ctx.putImageData(d, 0, 0);\n    d = null;\n    d = ctx.getImageData(0, 0, 2, 1);\n\n    if (d.data[0] === 12 && d.data[1] === 23 && d.data[2] === 34 && d.data[3] === 255 && d.data[4] === 45 && d.data[5] === 56 && d.data[6] === 67 && d.data[7] === 255) {\n      usable = true;\n    }\n  } catch (err) {}\n\n  return usable;\n}; // Check if createImageBitmap(img, sx, sy, sw, sh) signature works correctly\n// with JPEG images oriented with Exif;\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n// TODO: remove after it's fixed in chrome for at least 2 releases\n\n\nmodule.exports.cib_can_use_region = function cib_can_use_region() {\n  return new Promise(function (resolve) {\n    if (typeof createImageBitmap === 'undefined') {\n      resolve(false);\n      return;\n    }\n\n    var image = new Image();\n    image.src = 'data:image/jpeg;base64,' + '/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA' + 'AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9' + 'sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc' + 'ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa' + 'GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA' + 'f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA' + 'IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA' + 'AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB' + 'AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA' + 'AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA' + 'AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ' + 'QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';\n\n    image.onload = function () {\n      createImageBitmap(image, 0, 0, image.width, image.height).then(function (bitmap) {\n        if (bitmap.width === image.width && bitmap.height === image.height) {\n          resolve(true);\n        } else {\n          resolve(false);\n        }\n      }, function () {\n        return resolve(false);\n      });\n    };\n\n    image.onerror = function () {\n      return resolve(false);\n    };\n  });\n};\n\n},{}],17:[function(_dereq_,module,exports){\n\nmodule.exports = function () {\n  var MathLib = _dereq_('./mathlib');\n\n  var mathLib;\n  /* eslint-disable no-undef */\n\n  onmessage = function onmessage(ev) {\n    var tileOpts = ev.data.opts;\n    var returnBitmap = false;\n\n    if (!tileOpts.src && tileOpts.srcBitmap) {\n      var canvas = new OffscreenCanvas(tileOpts.width, tileOpts.height);\n      var ctx = canvas.getContext('2d', {\n        alpha: Boolean(tileOpts.alpha)\n      });\n      ctx.drawImage(tileOpts.srcBitmap, 0, 0);\n      tileOpts.src = ctx.getImageData(0, 0, tileOpts.width, tileOpts.height).data;\n      canvas.width = canvas.height = 0;\n      canvas = null;\n      tileOpts.srcBitmap.close();\n      tileOpts.srcBitmap = null;\n      returnBitmap = true;\n    }\n\n    if (!mathLib) mathLib = new MathLib(ev.data.features); // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n    // because polyfills are not propagated to webworker.\n\n    var data = mathLib.resizeAndUnsharp(tileOpts);\n\n    if (returnBitmap) {\n      var toImageData = new ImageData(new Uint8ClampedArray(data), tileOpts.toWidth, tileOpts.toHeight);\n\n      var _canvas = new OffscreenCanvas(tileOpts.toWidth, tileOpts.toHeight);\n\n      var _ctx = _canvas.getContext('2d', {\n        alpha: Boolean(tileOpts.alpha)\n      });\n\n      _ctx.putImageData(toImageData, 0, 0);\n\n      createImageBitmap(_canvas).then(function (bitmap) {\n        postMessage({\n          bitmap: bitmap\n        }, [bitmap]);\n      });\n    } else {\n      postMessage({\n        data: data\n      }, [data.buffer]);\n    }\n  };\n};\n\n},{\"./mathlib\":1}],18:[function(_dereq_,module,exports){\n// Calculate Gaussian blur of an image using IIR filter\n// The method is taken from Intel's white paper and code example attached to it:\n// https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n// -implementation-using-intel-advanced-vector-extensions\n\nvar a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\nfunction gaussCoef(sigma) {\n  if (sigma < 0.5) {\n    sigma = 0.5;\n  }\n\n  var a = Math.exp(0.726 * 0.726) / sigma,\n      g1 = Math.exp(-a),\n      g2 = Math.exp(-2 * a),\n      k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n\n  a0 = k;\n  a1 = k * (a - 1) * g1;\n  a2 = k * (a + 1) * g1;\n  a3 = -k * g2;\n  b1 = 2 * g1;\n  b2 = -g2;\n  left_corner = (a0 + a1) / (1 - b1 - b2);\n  right_corner = (a2 + a3) / (1 - b1 - b2);\n\n  // Attempt to force type to FP32.\n  return new Float32Array([ a0, a1, a2, a3, b1, b2, left_corner, right_corner ]);\n}\n\nfunction convolveMono16(src, out, line, coeff, width, height) {\n  // takes src image and writes the blurred and transposed result into out\n\n  var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n  var src_index, out_index, line_index;\n  var i, j;\n  var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n  for (i = 0; i < height; i++) {\n    src_index = i * width;\n    out_index = i;\n    line_index = 0;\n\n    // left to right\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[6];\n    prev_out = prev_prev_out;\n\n    coeff_a0 = coeff[0];\n    coeff_a1 = coeff[1];\n    coeff_b1 = coeff[4];\n    coeff_b2 = coeff[5];\n\n    for (j = 0; j < width; j++) {\n      curr_src = src[src_index];\n\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n      prev_src = curr_src;\n\n      line[line_index] = prev_out;\n      line_index++;\n      src_index++;\n    }\n\n    src_index--;\n    line_index--;\n    out_index += height * (width - 1);\n\n    // right to left\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[7];\n    prev_out = prev_prev_out;\n    curr_src = prev_src;\n\n    coeff_a0 = coeff[2];\n    coeff_a1 = coeff[3];\n\n    for (j = width - 1; j >= 0; j--) {\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n\n      prev_src = curr_src;\n      curr_src = src[src_index];\n\n      out[out_index] = line[line_index] + prev_out;\n\n      src_index--;\n      line_index--;\n      out_index -= height;\n    }\n  }\n}\n\n\nfunction blurMono16(src, width, height, radius) {\n  // Quick exit on zero radius\n  if (!radius) { return; }\n\n  var out      = new Uint16Array(src.length),\n      tmp_line = new Float32Array(Math.max(width, height));\n\n  var coeff = gaussCoef(radius);\n\n  convolveMono16(src, out, tmp_line, coeff, width, height);\n  convolveMono16(out, src, tmp_line, coeff, height, width);\n}\n\nmodule.exports = blurMono16;\n\n},{}],19:[function(_dereq_,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor;\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor;\n      var TempCtor = function () {};\n      TempCtor.prototype = superCtor.prototype;\n      ctor.prototype = new TempCtor();\n      ctor.prototype.constructor = ctor;\n    }\n  };\n}\n\n},{}],20:[function(_dereq_,module,exports){\n\n\nvar assign         = _dereq_('object-assign');\nvar base64decode   = _dereq_('./lib/base64decode');\nvar hasWebAssembly = _dereq_('./lib/wa_detect');\n\n\nvar DEFAULT_OPTIONS = {\n  js: true,\n  wasm: true\n};\n\n\nfunction MultiMath(options) {\n  if (!(this instanceof MultiMath)) return new MultiMath(options);\n\n  var opts = assign({}, DEFAULT_OPTIONS, options || {});\n\n  this.options         = opts;\n\n  this.__cache         = {};\n\n  this.__init_promise  = null;\n  this.__modules       = opts.modules || {};\n  this.__memory        = null;\n  this.__wasm          = {};\n\n  this.__isLE = ((new Uint32Array((new Uint8Array([ 1, 0, 0, 0 ])).buffer))[0] === 1);\n\n  if (!this.options.js && !this.options.wasm) {\n    throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n  }\n}\n\n\nMultiMath.prototype.has_wasm = hasWebAssembly;\n\n\nMultiMath.prototype.use = function (module) {\n  this.__modules[module.name] = module;\n\n  // Pin the best possible implementation\n  if (this.options.wasm && this.has_wasm() && module.wasm_fn) {\n    this[module.name] = module.wasm_fn;\n  } else {\n    this[module.name] = module.fn;\n  }\n\n  return this;\n};\n\n\nMultiMath.prototype.init = function () {\n  if (this.__init_promise) return this.__init_promise;\n\n  if (!this.options.js && this.options.wasm && !this.has_wasm()) {\n    return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n  }\n\n  var self = this;\n\n  this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n    var module = self.__modules[name];\n\n    if (!self.options.wasm || !self.has_wasm() || !module.wasm_fn) return null;\n\n    // If already compiled - exit\n    if (self.__wasm[name]) return null;\n\n    // Compile wasm source\n    return WebAssembly.compile(self.__base64decode(module.wasm_src))\n      .then(function (m) { self.__wasm[name] = m; });\n  }))\n    .then(function () { return self; });\n\n  return this.__init_promise;\n};\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Methods below are for internal use from plugins\n\n\n// Simple decode base64 to typed array. Useful to load embedded webassembly\n// code. You probably don't need to call this method directly.\n//\nMultiMath.prototype.__base64decode = base64decode;\n\n\n// Increase current memory to include specified number of bytes. Do nothing if\n// size is already ok. You probably don't need to call this method directly,\n// because it will be invoked from `.__instance()`.\n//\nMultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n  if (!this.__memory) {\n    this.__memory = new WebAssembly.Memory({\n      initial: Math.ceil(bytes / (64 * 1024))\n    });\n    return this.__memory;\n  }\n\n  var mem_size = this.__memory.buffer.byteLength;\n\n  if (mem_size < bytes) {\n    this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n  }\n\n  return this.__memory;\n};\n\n\n// Returns instantinated webassembly item by name, with specified memory size\n// and environment.\n// - use cache if available\n// - do sync module init, if async init was not called earlier\n// - allocate memory if not enougth\n// - can export functions to webassembly via \"env_extra\",\n//   for example, { exp: Math.exp }\n//\nMultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n  if (memsize) this.__reallocate(memsize);\n\n  // If .init() was not called, do sync compile\n  if (!this.__wasm[name]) {\n    var module = this.__modules[name];\n    this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n  }\n\n  if (!this.__cache[name]) {\n    var env_base = {\n      memoryBase: 0,\n      memory: this.__memory,\n      tableBase: 0,\n      table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })\n    };\n\n    this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n      env: assign(env_base, env_extra || {})\n    });\n  }\n\n  return this.__cache[name];\n};\n\n\n// Helper to calculate memory aligh for pointers. Webassembly does not require\n// this, but you may wish to experiment. Default base = 8;\n//\nMultiMath.prototype.__align = function align(number, base) {\n  base = base || 8;\n  var reminder = number % base;\n  return number + (reminder ? base - reminder : 0);\n};\n\n\nmodule.exports = MultiMath;\n\n},{\"./lib/base64decode\":21,\"./lib/wa_detect\":22,\"object-assign\":23}],21:[function(_dereq_,module,exports){\n\n\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n\nmodule.exports = function base64decode(str) {\n  var input = str.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max   = input.length;\n\n  var out = new Uint8Array((max * 3) >> 2);\n\n  // Collect by 6*4 bits (3 bytes)\n\n  var bits = 0;\n  var ptr  = 0;\n\n  for (var idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      out[ptr++] = (bits >> 16) & 0xFF;\n      out[ptr++] = (bits >> 8) & 0xFF;\n      out[ptr++] = bits & 0xFF;\n    }\n\n    bits = (bits << 6) | BASE64_MAP.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  var tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    out[ptr++] = (bits >> 16) & 0xFF;\n    out[ptr++] = (bits >> 8) & 0xFF;\n    out[ptr++] = bits & 0xFF;\n  } else if (tailbits === 18) {\n    out[ptr++] = (bits >> 10) & 0xFF;\n    out[ptr++] = (bits >> 2) & 0xFF;\n  } else if (tailbits === 12) {\n    out[ptr++] = (bits >> 4) & 0xFF;\n  }\n\n  return out;\n};\n\n},{}],22:[function(_dereq_,module,exports){\n\n\nvar wa;\n\n\nmodule.exports = function hasWebAssembly() {\n  // use cache if called before;\n  if (typeof wa !== 'undefined') return wa;\n\n  wa = false;\n\n  if (typeof WebAssembly === 'undefined') return wa;\n\n  // If WebAssenbly is disabled, code can throw on compile\n  try {\n    // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n    // Additional check that WA internals are correct\n\n    /* eslint-disable comma-spacing, max-len */\n    var bin      = new Uint8Array([ 0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11 ]);\n    var module   = new WebAssembly.Module(bin);\n    var instance = new WebAssembly.Instance(module, {});\n\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    if (instance.exports.test(4) !== 0) wa = true;\n\n    return wa;\n  } catch (__) {}\n\n  return wa;\n};\n\n},{}],23:[function(_dereq_,module,exports){\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n},{}],24:[function(_dereq_,module,exports){\nvar bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            'function(require,module,exports){' + fn + '(self); }',\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        'function(require,module,exports){' +\n            // try to call default if defined to also support babel esmodule exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);' +\n        '}',\n        scache\n    ];\n\n    var workerSources = {};\n    resolveSources(skey);\n\n    function resolveSources(key) {\n        workerSources[key] = true;\n\n        for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n            if (!workerSources[depKey]) {\n                resolveSources(depKey);\n            }\n        }\n    }\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n\n},{}],\"/index.js\":[function(_dereq_,module,exports){\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar assign = _dereq_('object-assign');\n\nvar webworkify = _dereq_('webworkify');\n\nvar MathLib = _dereq_('./lib/mathlib');\n\nvar Pool = _dereq_('./lib/pool');\n\nvar utils = _dereq_('./lib/utils');\n\nvar worker = _dereq_('./lib/worker');\n\nvar createStages = _dereq_('./lib/stepper');\n\nvar createRegions = _dereq_('./lib/tiler'); // Deduplicate pools & limiters with the same configs\n// when user creates multiple pica instances.\n\n\nvar singletones = {};\nvar NEED_SAFARI_FIX = false;\n\ntry {\n  if (typeof navigator !== 'undefined' && navigator.userAgent) {\n    NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n  }\n} catch (e) {}\n\nvar concurrency = 1;\n\nif (typeof navigator !== 'undefined') {\n  concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n}\n\nvar DEFAULT_PICA_OPTS = {\n  tile: 1024,\n  concurrency: concurrency,\n  features: ['js', 'wasm', 'ww'],\n  idle: 2000,\n  createCanvas: function createCanvas(width, height) {\n    var tmpCanvas = document.createElement('canvas');\n    tmpCanvas.width = width;\n    tmpCanvas.height = height;\n    return tmpCanvas;\n  }\n};\nvar DEFAULT_RESIZE_OPTS = {\n  quality: 3,\n  alpha: false,\n  unsharpAmount: 0,\n  unsharpRadius: 0.0,\n  unsharpThreshold: 0\n};\nvar CAN_NEW_IMAGE_DATA = false;\nvar CAN_CREATE_IMAGE_BITMAP = false;\nvar CAN_USE_CANVAS_GET_IMAGE_DATA = false;\nvar CAN_USE_OFFSCREEN_CANVAS = false;\nvar CAN_USE_CIB_REGION_FOR_IMAGE = false;\n\nfunction workerFabric() {\n  return {\n    value: webworkify(worker),\n    destroy: function destroy() {\n      this.value.terminate();\n\n      if (typeof window !== 'undefined') {\n        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n        if (url && url.revokeObjectURL && this.value.objectURL) {\n          url.revokeObjectURL(this.value.objectURL);\n        }\n      }\n    }\n  };\n} ////////////////////////////////////////////////////////////////////////////////\n// API methods\n\n\nfunction Pica(options) {\n  if (!(this instanceof Pica)) return new Pica(options);\n  this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n  var limiter_key = \"lk_\".concat(this.options.concurrency); // Share limiters to avoid multiple parallel workers when user creates\n  // multiple pica instances.\n\n  this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n  if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit; // List of supported features, according to options & browser/node.js\n\n  this.features = {\n    js: false,\n    // pure JS implementation, can be disabled for testing\n    wasm: false,\n    // webassembly implementation for heavy functions\n    cib: false,\n    // resize via createImageBitmap (only FF at this moment)\n    ww: false // webworkers\n\n  };\n  this.__workersPool = null; // Store requested features for webworkers\n\n  this.__requested_features = [];\n  this.__mathlib = null;\n}\n\nPica.prototype.init = function () {\n  var _this = this;\n\n  if (this.__initPromise) return this.__initPromise; // Test if we can create ImageData without canvas and memory copy\n\n  if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n    try {\n      /* eslint-disable no-new */\n      new ImageData(new Uint8ClampedArray(400), 10, 10);\n      CAN_NEW_IMAGE_DATA = true;\n    } catch (__) {}\n  } // ImageBitmap can be effective in 2 places:\n  //\n  // 1. Threaded jpeg unpack (basic)\n  // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n  //\n  // For basic use we also need ImageBitmap wo support .close() method,\n  // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n\n  if (typeof ImageBitmap !== 'undefined') {\n    if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n      CAN_CREATE_IMAGE_BITMAP = true;\n    } else {\n      this.debug('ImageBitmap does not support .close(), disabled');\n    }\n  }\n\n  var features = this.options.features.slice();\n\n  if (features.indexOf('all') >= 0) {\n    features = ['cib', 'wasm', 'js', 'ww'];\n  }\n\n  this.__requested_features = features;\n  this.__mathlib = new MathLib(features); // Check WebWorker support if requested\n\n  if (features.indexOf('ww') >= 0) {\n    if (typeof window !== 'undefined' && 'Worker' in window) {\n      // IE <= 11 don't allow to create webworkers from string. We should check it.\n      // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n      try {\n        var wkr = _dereq_('webworkify')(function () {});\n\n        wkr.terminate();\n        this.features.ww = true; // pool uniqueness depends on pool config + webworker config\n\n        var wpool_key = \"wp_\".concat(JSON.stringify(this.options));\n\n        if (singletones[wpool_key]) {\n          this.__workersPool = singletones[wpool_key];\n        } else {\n          this.__workersPool = new Pool(workerFabric, this.options.idle);\n          singletones[wpool_key] = this.__workersPool;\n        }\n      } catch (__) {}\n    }\n  }\n\n  var initMath = this.__mathlib.init().then(function (mathlib) {\n    // Copy detected features\n    assign(_this.features, mathlib.features);\n  });\n\n  var checkCibResize;\n\n  if (!CAN_CREATE_IMAGE_BITMAP) {\n    checkCibResize = Promise.resolve(false);\n  } else {\n    checkCibResize = utils.cib_support(this.options.createCanvas).then(function (status) {\n      if (_this.features.cib && features.indexOf('cib') < 0) {\n        _this.debug('createImageBitmap() resize supported, but disabled by config');\n\n        return;\n      }\n\n      if (features.indexOf('cib') >= 0) _this.features.cib = status;\n    });\n  }\n\n  CAN_USE_CANVAS_GET_IMAGE_DATA = utils.can_use_canvas(this.options.createCanvas);\n  var checkOffscreenCanvas;\n\n  if (CAN_CREATE_IMAGE_BITMAP && CAN_NEW_IMAGE_DATA && features.indexOf('ww') !== -1) {\n    checkOffscreenCanvas = utils.worker_offscreen_canvas_support();\n  } else {\n    checkOffscreenCanvas = Promise.resolve(false);\n  }\n\n  checkOffscreenCanvas = checkOffscreenCanvas.then(function (result) {\n    CAN_USE_OFFSCREEN_CANVAS = result;\n  }); // we use createImageBitmap to crop image data and pass it to workers,\n  // so need to check whether function works correctly;\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n\n  var checkCibRegion = utils.cib_can_use_region().then(function (result) {\n    CAN_USE_CIB_REGION_FOR_IMAGE = result;\n  }); // Init math lib. That's async because can load some\n\n  this.__initPromise = Promise.all([initMath, checkCibResize, checkOffscreenCanvas, checkCibRegion]).then(function () {\n    return _this;\n  });\n  return this.__initPromise;\n}; // Call resizer in webworker or locally, depending on config\n\n\nPica.prototype.__invokeResize = function (tileOpts, opts) {\n  var _this2 = this;\n\n  // Share cache between calls:\n  //\n  // - wasm instance\n  // - wasm memory object\n  //\n  opts.__mathCache = opts.__mathCache || {};\n  return Promise.resolve().then(function () {\n    if (!_this2.features.ww) {\n      // not possible to have ImageBitmap here if user disabled WW\n      return {\n        data: _this2.__mathlib.resizeAndUnsharp(tileOpts, opts.__mathCache)\n      };\n    }\n\n    return new Promise(function (resolve, reject) {\n      var w = _this2.__workersPool.acquire();\n\n      if (opts.cancelToken) opts.cancelToken[\"catch\"](function (err) {\n        return reject(err);\n      });\n\n      w.value.onmessage = function (ev) {\n        w.release();\n        if (ev.data.err) reject(ev.data.err);else resolve(ev.data);\n      };\n\n      var transfer = [];\n      if (tileOpts.src) transfer.push(tileOpts.src.buffer);\n      if (tileOpts.srcBitmap) transfer.push(tileOpts.srcBitmap);\n      w.value.postMessage({\n        opts: tileOpts,\n        features: _this2.__requested_features,\n        preload: {\n          wasm_nodule: _this2.__mathlib.__\n        }\n      }, transfer);\n    });\n  });\n}; // this function can return promise if createImageBitmap is used\n\n\nPica.prototype.__extractTileData = function (tile, from, opts, stageEnv, extractTo) {\n  if (this.features.ww && CAN_USE_OFFSCREEN_CANVAS && ( // createImageBitmap doesn't work for images (Image, ImageBitmap) with Exif orientation in Chrome,\n  // can use canvas because canvas doesn't have orientation;\n  // see https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n  utils.isCanvas(from) || CAN_USE_CIB_REGION_FOR_IMAGE)) {\n    this.debug('Create tile for OffscreenCanvas');\n    return createImageBitmap(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height).then(function (bitmap) {\n      extractTo.srcBitmap = bitmap;\n      return extractTo;\n    });\n  } // Extract tile RGBA buffer, depending on input type\n\n\n  if (utils.isCanvas(from)) {\n    if (!stageEnv.srcCtx) stageEnv.srcCtx = from.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    }); // If input is Canvas - extract region data directly\n\n    this.debug('Get tile pixel data');\n    extractTo.src = stageEnv.srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height).data;\n    return extractTo;\n  } // If input is Image or decoded to ImageBitmap,\n  // draw region to temporary canvas and extract data from it\n  //\n  // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n  //\n\n\n  this.debug('Draw tile imageBitmap/image to temporary canvas');\n  var tmpCanvas = this.options.createCanvas(tile.width, tile.height);\n  var tmpCtx = tmpCanvas.getContext('2d', {\n    alpha: Boolean(opts.alpha)\n  });\n  tmpCtx.globalCompositeOperation = 'copy';\n  tmpCtx.drawImage(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n  this.debug('Get tile pixel data');\n  extractTo.src = tmpCtx.getImageData(0, 0, tile.width, tile.height).data; // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n\n  tmpCanvas.width = tmpCanvas.height = 0;\n  return extractTo;\n};\n\nPica.prototype.__landTileData = function (tile, result, stageEnv) {\n  var toImageData;\n  this.debug('Convert raw rgba tile result to ImageData');\n\n  if (result.bitmap) {\n    stageEnv.toCtx.drawImage(result.bitmap, tile.toX, tile.toY);\n    return null;\n  }\n\n  if (CAN_NEW_IMAGE_DATA) {\n    // this branch is for modern browsers\n    // If `new ImageData()` & Uint8ClampedArray suported\n    toImageData = new ImageData(new Uint8ClampedArray(result.data), tile.toWidth, tile.toHeight);\n  } else {\n    // fallback for `node-canvas` and old browsers\n    // (IE11 has ImageData but does not support `new ImageData()`)\n    toImageData = stageEnv.toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n    if (toImageData.data.set) {\n      toImageData.data.set(result.data);\n    } else {\n      // IE9 don't have `.set()`\n      for (var i = toImageData.data.length - 1; i >= 0; i--) {\n        toImageData.data[i] = result.data[i];\n      }\n    }\n  }\n\n  this.debug('Draw tile');\n\n  if (NEED_SAFARI_FIX) {\n    // Safari draws thin white stripes between tiles without this fix\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n  } else {\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n  }\n\n  return null;\n};\n\nPica.prototype.__tileAndResize = function (from, to, opts) {\n  var _this3 = this;\n\n  var stageEnv = {\n    srcCtx: null,\n    srcImageBitmap: null,\n    isImageBitmapReused: false,\n    toCtx: null\n  };\n\n  var processTile = function processTile(tile) {\n    return _this3.__limit(function () {\n      if (opts.canceled) return opts.cancelToken;\n      var tileOpts = {\n        width: tile.width,\n        height: tile.height,\n        toWidth: tile.toWidth,\n        toHeight: tile.toHeight,\n        scaleX: tile.scaleX,\n        scaleY: tile.scaleY,\n        offsetX: tile.offsetX,\n        offsetY: tile.offsetY,\n        quality: opts.quality,\n        alpha: opts.alpha,\n        unsharpAmount: opts.unsharpAmount,\n        unsharpRadius: opts.unsharpRadius,\n        unsharpThreshold: opts.unsharpThreshold\n      };\n\n      _this3.debug('Invoke resize math');\n\n      return Promise.resolve(tileOpts).then(function (tileOpts) {\n        return _this3.__extractTileData(tile, from, opts, stageEnv, tileOpts);\n      }).then(function (tileOpts) {\n        _this3.debug('Invoke resize math');\n\n        return _this3.__invokeResize(tileOpts, opts);\n      }).then(function (result) {\n        if (opts.canceled) return opts.cancelToken;\n        stageEnv.srcImageData = null;\n        return _this3.__landTileData(tile, result, stageEnv);\n      });\n    });\n  }; // Need to normalize data source first. It can be canvas or image.\n  // If image - try to decode in background if possible\n\n\n  return Promise.resolve().then(function () {\n    stageEnv.toCtx = to.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    });\n    if (utils.isCanvas(from)) return null;\n\n    if (utils.isImageBitmap(from)) {\n      stageEnv.srcImageBitmap = from;\n      stageEnv.isImageBitmapReused = true;\n      return null;\n    }\n\n    if (utils.isImage(from)) {\n      // try do decode image in background for faster next operations;\n      // if we're using offscreen canvas, cib is called per tile, so not needed here\n      if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n      _this3.debug('Decode image via createImageBitmap');\n\n      return createImageBitmap(from).then(function (imageBitmap) {\n        stageEnv.srcImageBitmap = imageBitmap;\n      }) // Suppress error to use fallback, if method fails\n      // https://github.com/nodeca/pica/issues/190\n\n      /* eslint-disable no-unused-vars */\n      [\"catch\"](function (e) {\n        return null;\n      });\n    }\n\n    throw new Error('Pica: \".from\" should be Image, Canvas or ImageBitmap');\n  }).then(function () {\n    if (opts.canceled) return opts.cancelToken;\n\n    _this3.debug('Calculate tiles'); //\n    // Here we are with \"normalized\" source,\n    // follow to tiling\n    //\n\n\n    var regions = createRegions({\n      width: opts.width,\n      height: opts.height,\n      srcTileSize: _this3.options.tile,\n      toWidth: opts.toWidth,\n      toHeight: opts.toHeight,\n      destTileBorder: opts.__destTileBorder\n    });\n    var jobs = regions.map(function (tile) {\n      return processTile(tile);\n    });\n\n    function cleanup(stageEnv) {\n      if (stageEnv.srcImageBitmap) {\n        if (!stageEnv.isImageBitmapReused) stageEnv.srcImageBitmap.close();\n        stageEnv.srcImageBitmap = null;\n      }\n    }\n\n    _this3.debug('Process tiles');\n\n    return Promise.all(jobs).then(function () {\n      _this3.debug('Finished!');\n\n      cleanup(stageEnv);\n      return to;\n    }, function (err) {\n      cleanup(stageEnv);\n      throw err;\n    });\n  });\n};\n\nPica.prototype.__processStages = function (stages, from, to, opts) {\n  var _this4 = this;\n\n  if (opts.canceled) return opts.cancelToken;\n\n  var _stages$shift = stages.shift(),\n      _stages$shift2 = _slicedToArray(_stages$shift, 2),\n      toWidth = _stages$shift2[0],\n      toHeight = _stages$shift2[1];\n\n  var isLastStage = stages.length === 0;\n  opts = assign({}, opts, {\n    toWidth: toWidth,\n    toHeight: toHeight,\n    // only use user-defined quality for the last stage,\n    // use simpler (Hamming) filter for the first stages where\n    // scale factor is large enough (more than 2-3)\n    quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n  });\n  var tmpCanvas;\n\n  if (!isLastStage) {\n    // create temporary canvas\n    tmpCanvas = this.options.createCanvas(toWidth, toHeight);\n  }\n\n  return this.__tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n    if (isLastStage) return to;\n    opts.width = toWidth;\n    opts.height = toHeight;\n    return _this4.__processStages(stages, tmpCanvas, to, opts);\n  }).then(function (res) {\n    if (tmpCanvas) {\n      // Safari 12 workaround\n      // https://github.com/nodeca/pica/issues/199\n      tmpCanvas.width = tmpCanvas.height = 0;\n    }\n\n    return res;\n  });\n};\n\nPica.prototype.__resizeViaCreateImageBitmap = function (from, to, opts) {\n  var _this5 = this;\n\n  var toCtx = to.getContext('2d', {\n    alpha: Boolean(opts.alpha)\n  });\n  this.debug('Resize via createImageBitmap()');\n  return createImageBitmap(from, {\n    resizeWidth: opts.toWidth,\n    resizeHeight: opts.toHeight,\n    resizeQuality: utils.cib_quality_name(opts.quality)\n  }).then(function (imageBitmap) {\n    if (opts.canceled) return opts.cancelToken; // if no unsharp - draw directly to output canvas\n\n    if (!opts.unsharpAmount) {\n      toCtx.drawImage(imageBitmap, 0, 0);\n      imageBitmap.close();\n      toCtx = null;\n\n      _this5.debug('Finished!');\n\n      return to;\n    }\n\n    _this5.debug('Unsharp result');\n\n    var tmpCanvas = _this5.options.createCanvas(opts.toWidth, opts.toHeight);\n\n    var tmpCtx = tmpCanvas.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    });\n    tmpCtx.drawImage(imageBitmap, 0, 0);\n    imageBitmap.close();\n    var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n    _this5.__mathlib.unsharp_mask(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n    toCtx.putImageData(iData, 0, 0); // Safari 12 workaround\n    // https://github.com/nodeca/pica/issues/199\n\n    tmpCanvas.width = tmpCanvas.height = 0;\n    iData = tmpCtx = tmpCanvas = toCtx = null;\n\n    _this5.debug('Finished!');\n\n    return to;\n  });\n};\n\nPica.prototype.resize = function (from, to, options) {\n  var _this6 = this;\n\n  this.debug('Start resize...');\n  var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n  if (!isNaN(options)) {\n    opts = assign(opts, {\n      quality: options\n    });\n  } else if (options) {\n    opts = assign(opts, options);\n  }\n\n  opts.toWidth = to.width;\n  opts.toHeight = to.height;\n  opts.width = from.naturalWidth || from.width;\n  opts.height = from.naturalHeight || from.height; // Prevent stepper from infinite loop\n\n  if (to.width === 0 || to.height === 0) {\n    return Promise.reject(new Error(\"Invalid output size: \".concat(to.width, \"x\").concat(to.height)));\n  }\n\n  if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n  opts.canceled = false;\n\n  if (opts.cancelToken) {\n    // Wrap cancelToken to avoid successive resolve & set flag\n    opts.cancelToken = opts.cancelToken.then(function (data) {\n      opts.canceled = true;\n      throw data;\n    }, function (err) {\n      opts.canceled = true;\n      throw err;\n    });\n  }\n\n  var DEST_TILE_BORDER = 3; // Max possible filter window size\n\n  opts.__destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n  return this.init().then(function () {\n    if (opts.canceled) return opts.cancelToken; // if createImageBitmap supports resize, just do it and return\n\n    if (_this6.features.cib) {\n      return _this6.__resizeViaCreateImageBitmap(from, to, opts);\n    }\n\n    if (!CAN_USE_CANVAS_GET_IMAGE_DATA) {\n      var err = new Error('Pica: cannot use getImageData on canvas, ' + \"make sure fingerprinting protection isn't enabled\");\n      err.code = 'ERR_GET_IMAGE_DATA';\n      throw err;\n    } //\n    // No easy way, let's resize manually via arrays\n    //\n\n\n    var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this6.options.tile, opts.__destTileBorder);\n    return _this6.__processStages(stages, from, to, opts);\n  });\n}; // RGBA buffer resize\n//\n\n\nPica.prototype.resizeBuffer = function (options) {\n  var _this7 = this;\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n  return this.init().then(function () {\n    return _this7.__mathlib.resizeAndUnsharp(opts);\n  });\n};\n\nPica.prototype.toBlob = function (canvas, mimeType, quality) {\n  mimeType = mimeType || 'image/png';\n  return new Promise(function (resolve) {\n    if (canvas.toBlob) {\n      canvas.toBlob(function (blob) {\n        return resolve(blob);\n      }, mimeType, quality);\n      return;\n    }\n\n    if (canvas.convertToBlob) {\n      resolve(canvas.convertToBlob({\n        type: mimeType,\n        quality: quality\n      }));\n      return;\n    } // Fallback for old browsers\n\n\n    var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n    var len = asString.length;\n    var asBuffer = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      asBuffer[i] = asString.charCodeAt(i);\n    }\n\n    resolve(new Blob([asBuffer], {\n      type: mimeType\n    }));\n  });\n};\n\nPica.prototype.debug = function () {};\n\nmodule.exports = Pica;\n\n},{\"./lib/mathlib\":1,\"./lib/pool\":13,\"./lib/stepper\":14,\"./lib/tiler\":15,\"./lib/utils\":16,\"./lib/worker\":17,\"object-assign\":23,\"webworkify\":24}]},{},[])(\"/index.js\")\n});\n});\n\nvar image_traverse = createCommonjsModule(function (module) {\n\n//////////////////////////////////////////////////////////////////////////\n// Helpers\n//\nfunction error(message, code) {\n  var err = new Error(message);\n  err.code = code;\n  return err;\n}\n\n\n// Convert number to 0xHH string\n//\nfunction to_hex(number) {\n  var n = number.toString(16).toUpperCase();\n  for (var i = 2 - n.length; i > 0; i--) n = '0' + n;\n  return '0x' + n;\n}\n\n\nfunction utf8_encode(str) {\n  try {\n    return unescape(encodeURIComponent(str));\n  } catch (_) {\n    return str;\n  }\n}\n\n\nfunction utf8_decode(str) {\n  try {\n    return decodeURIComponent(escape(str));\n  } catch (_) {\n    return str;\n  }\n}\n\n\n// Check if input is a Uint8Array\n//\nfunction is_uint8array(bin) {\n  return Object.prototype.toString.call(bin) === '[object Uint8Array]';\n}\n\n\n//////////////////////////////////////////////////////////////////////////\n// Exif parser\n//\n// Input:\n//  - jpeg_bin:   Uint8Array - jpeg file\n//  - exif_start: Number     - start of TIFF header (after Exif\\0\\0)\n//  - exif_end:   Number     - end of Exif segment\n//  - on_entry:   Number     - callback\n//\nfunction ExifParser(jpeg_bin, exif_start, exif_end) {\n  // Uint8Array, exif without signature (which isn't included in offsets)\n  this.input      = jpeg_bin.subarray(exif_start, exif_end);\n\n  // offset correction for `on_entry` callback\n  this.start      = exif_start;\n\n  // Check TIFF header (includes byte alignment and first IFD offset)\n  var sig = String.fromCharCode.apply(null, this.input.subarray(0, 4));\n\n  if (sig !== 'II\\x2A\\0' && sig !== 'MM\\0\\x2A') {\n    throw error('invalid TIFF signature', 'EBADDATA');\n  }\n\n  // true if motorola (big endian) byte alignment, false if intel\n  this.big_endian = sig[0] === 'M';\n}\n\n\nExifParser.prototype.each = function (on_entry) {\n  // allow premature exit\n  this.aborted = false;\n\n  var offset = this.read_uint32(4);\n\n  this.ifds_to_read = [ {\n    id:     0,\n    offset: offset\n  } ];\n\n  while (this.ifds_to_read.length > 0 && !this.aborted) {\n    var i = this.ifds_to_read.shift();\n    if (!i.offset) continue;\n    this.scan_ifd(i.id, i.offset, on_entry);\n  }\n};\n\n\nExifParser.prototype.filter = function (on_entry) {\n  var ifds = {};\n\n  // make sure IFD0 always exists\n  ifds.ifd0 = { id: 0, entries: [] };\n\n  this.each(function (entry) {\n    if (on_entry(entry) === false && !entry.is_subifd_link) return;\n    if (entry.is_subifd_link && entry.count !== 1 && entry.format !== 4) return; // filter out bogus links\n\n    if (!ifds['ifd' + entry.ifd]) {\n      ifds['ifd' + entry.ifd] = { id: entry.ifd, entries: [] };\n    }\n\n    ifds['ifd' + entry.ifd].entries.push(entry);\n  });\n\n  // thumbnails are not supported just yet, so delete all information related to it\n  delete ifds.ifd1;\n\n  // Calculate output size\n  var length = 8;\n  Object.keys(ifds).forEach(function (ifd_no) {\n    length += 2;\n\n    ifds[ifd_no].entries.forEach(function (entry) {\n      length += 12 + (entry.data_length > 4 ? Math.ceil(entry.data_length / 2) * 2 : 0);\n    });\n\n    length += 4;\n  });\n\n  this.output = new Uint8Array(length);\n  this.output[0] = this.output[1] = (this.big_endian ? 'M' : 'I').charCodeAt(0);\n  this.write_uint16(2, 0x2A);\n\n  var offset = 8;\n  var self = this;\n  this.write_uint32(4, offset);\n\n  Object.keys(ifds).forEach(function (ifd_no) {\n    ifds[ifd_no].written_offset = offset;\n\n    var ifd_start = offset;\n    var ifd_end   = ifd_start + 2 + ifds[ifd_no].entries.length * 12 + 4;\n    offset = ifd_end;\n\n    self.write_uint16(ifd_start, ifds[ifd_no].entries.length);\n\n    ifds[ifd_no].entries.sort(function (a, b) {\n      // IFD entries must be in order of increasing tag IDs\n      return a.tag - b.tag;\n    }).forEach(function (entry, idx) {\n      var entry_offset = ifd_start + 2 + idx * 12;\n\n      self.write_uint16(entry_offset, entry.tag);\n      self.write_uint16(entry_offset + 2, entry.format);\n      self.write_uint32(entry_offset + 4, entry.count);\n\n      if (entry.is_subifd_link) {\n        // filled in later\n        if (ifds['ifd' + entry.tag]) ifds['ifd' + entry.tag].link_offset = entry_offset + 8;\n      } else if (entry.data_length <= 4) {\n        self.output.set(\n          self.input.subarray(entry.data_offset - self.start, entry.data_offset - self.start + 4),\n          entry_offset + 8\n        );\n      } else {\n        self.write_uint32(entry_offset + 8, offset);\n        self.output.set(\n          self.input.subarray(entry.data_offset - self.start, entry.data_offset - self.start + entry.data_length),\n          offset\n        );\n        offset += Math.ceil(entry.data_length / 2) * 2;\n      }\n    });\n\n    var next_ifd = ifds['ifd' + (ifds[ifd_no].id + 1)];\n    if (next_ifd) next_ifd.link_offset = ifd_end - 4;\n  });\n\n  Object.keys(ifds).forEach(function (ifd_no) {\n    if (ifds[ifd_no].written_offset && ifds[ifd_no].link_offset) {\n      self.write_uint32(ifds[ifd_no].link_offset, ifds[ifd_no].written_offset);\n    }\n  });\n\n  if (this.output.length !== offset) throw error('internal error: incorrect buffer size allocated');\n\n  return this.output;\n};\n\n\nExifParser.prototype.read_uint16 = function (offset) {\n  var d = this.input;\n  if (offset + 2 > d.length) throw error('unexpected EOF', 'EBADDATA');\n\n  return this.big_endian ?\n    d[offset] * 0x100 + d[offset + 1] :\n    d[offset] + d[offset + 1] * 0x100;\n};\n\n\nExifParser.prototype.read_uint32 = function (offset) {\n  var d = this.input;\n  if (offset + 4 > d.length) throw error('unexpected EOF', 'EBADDATA');\n\n  return this.big_endian ?\n    d[offset] * 0x1000000 + d[offset + 1] * 0x10000 + d[offset + 2] * 0x100 + d[offset + 3] :\n    d[offset] + d[offset + 1] * 0x100 + d[offset + 2] * 0x10000 + d[offset + 3] * 0x1000000;\n};\n\n\nExifParser.prototype.write_uint16 = function (offset, value) {\n  var d = this.output;\n\n  if (this.big_endian) {\n    d[offset]     = (value >>> 8) & 0xFF;\n    d[offset + 1] = value & 0xFF;\n  } else {\n    d[offset]     = value & 0xFF;\n    d[offset + 1] = (value >>> 8) & 0xFF;\n  }\n};\n\n\nExifParser.prototype.write_uint32 = function (offset, value) {\n  var d = this.output;\n\n  if (this.big_endian) {\n    d[offset]     = (value >>> 24) & 0xFF;\n    d[offset + 1] = (value >>> 16) & 0xFF;\n    d[offset + 2] = (value >>> 8) & 0xFF;\n    d[offset + 3] = value & 0xFF;\n  } else {\n    d[offset]     = value & 0xFF;\n    d[offset + 1] = (value >>> 8) & 0xFF;\n    d[offset + 2] = (value >>> 16) & 0xFF;\n    d[offset + 3] = (value >>> 24) & 0xFF;\n  }\n};\n\n\nExifParser.prototype.is_subifd_link = function (ifd, tag) {\n  return (ifd === 0 && tag === 0x8769) || // SubIFD\n         (ifd === 0 && tag === 0x8825) || // GPS Info\n         (ifd === 0x8769 && tag === 0xA005); // Interop IFD\n};\n\n\n// Returns byte length of a single component of a given format\n//\nExifParser.prototype.exif_format_length = function (format) {\n  switch (format) {\n    case 1: // byte\n    case 2: // ascii\n    case 6: // sbyte\n    case 7: // undefined\n      return 1;\n\n    case 3: // short\n    case 8: // sshort\n      return 2;\n\n    case 4:  // long\n    case 9:  // slong\n    case 11: // float\n      return 4;\n\n    case 5:  // rational\n    case 10: // srational\n    case 12: // double\n      return 8;\n\n    default:\n      // unknown type\n      return 0;\n  }\n};\n\n\n// Reads Exif data\n//\nExifParser.prototype.exif_format_read = function (format, offset) {\n  var v;\n\n  switch (format) {\n    case 1: // byte\n    case 2: // ascii\n      v = this.input[offset];\n      return v;\n\n    case 6: // sbyte\n      v = this.input[offset];\n      return v | (v & 0x80) * 0x1fffffe;\n\n    case 3: // short\n      v = this.read_uint16(offset);\n      return v;\n\n    case 8: // sshort\n      v = this.read_uint16(offset);\n      return v | (v & 0x8000) * 0x1fffe;\n\n    case 4: // long\n      v = this.read_uint32(offset);\n      return v;\n\n    case 9: // slong\n      v = this.read_uint32(offset);\n      return v | 0;\n\n    case 5:  // rational\n    case 10: // srational\n    case 11: // float\n    case 12: // double\n      return null; // not implemented\n\n    case 7: // undefined\n      return null; // blob\n\n    default:\n      // unknown type\n      return null;\n  }\n};\n\n\nExifParser.prototype.scan_ifd = function (ifd_no, offset, on_entry) {\n  var entry_count = this.read_uint16(offset);\n\n  offset += 2;\n\n  for (var i = 0; i < entry_count; i++) {\n    var tag    = this.read_uint16(offset);\n    var format = this.read_uint16(offset + 2);\n    var count  = this.read_uint32(offset + 4);\n\n    var comp_length    = this.exif_format_length(format);\n    var data_length    = count * comp_length;\n    var data_offset    = data_length <= 4 ? offset + 8 : this.read_uint32(offset + 8);\n    var is_subifd_link = false;\n\n    if (data_offset + data_length > this.input.length) {\n      throw error('unexpected EOF', 'EBADDATA');\n    }\n\n    var value = [];\n    var comp_offset = data_offset;\n\n    for (var j = 0; j < count; j++, comp_offset += comp_length) {\n      var item = this.exif_format_read(format, comp_offset);\n      if (item === null) {\n        value = null;\n        break;\n      }\n      value.push(item);\n    }\n\n    if (Array.isArray(value) && format === 2) {\n      try {\n        value = utf8_decode(String.fromCharCode.apply(null, value));\n      } catch (_) {\n        value = null;\n      }\n\n      if (value && value[value.length - 1] === '\\0') value = value.slice(0, -1);\n    }\n\n    if (this.is_subifd_link(ifd_no, tag)) {\n      if (Array.isArray(value) && Number.isInteger(value[0]) && value[0] > 0) {\n        this.ifds_to_read.push({\n          id:     tag,\n          offset: value[0]\n        });\n        is_subifd_link = true;\n      }\n    }\n\n    var entry = {\n      is_big_endian:  this.big_endian,\n      ifd:            ifd_no,\n      tag:            tag,\n      format:         format,\n      count:          count,\n      entry_offset:   offset + this.start,\n      data_length:    data_length,\n      data_offset:    data_offset + this.start,\n      value:          value,\n      is_subifd_link: is_subifd_link\n    };\n\n    if (on_entry(entry) === false) {\n      this.aborted = true;\n      return;\n    }\n\n    offset += 12;\n  }\n\n  if (ifd_no === 0) {\n    this.ifds_to_read.push({\n      id:     1,\n      offset: this.read_uint32(offset)\n    });\n  }\n};\n\n\n// Check whether input is a JPEG image\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//\n// Returns true if it is and false otherwise\n//\nmodule.exports.is_jpeg = function (jpeg_bin) {\n  return jpeg_bin.length >= 4 && jpeg_bin[0] === 0xFF && jpeg_bin[1] === 0xD8 && jpeg_bin[2] === 0xFF;\n};\n\n\n// Call an iterator on each segment in the given JPEG image\n//\n// Input:\n//  - jpeg_bin:   Uint8Array - jpeg file\n//  - on_segment: Function - callback executed on each JPEG marker segment\n//    - segment:  Object\n//      - code:   Number - marker type (2nd byte, e.g. 0xE0 for APP0)\n//      - offset: Number - offset of the first byte (0xFF) relative to `jpeg_bin` start\n//      - length: Number - length of the entire marker segment including first two bytes and length\n//        - 2 for standalone markers\n//        - 4+length for markers with data\n//\n// Iteration stops when `EOI` (0xFFD9) marker is reached or if `on_segment`\n// function returns `false`.\n//\nmodule.exports.jpeg_segments_each = function (jpeg_bin, on_segment) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_segment !== 'function') {\n    throw error('Invalid argument (on_segment), Function expected', 'EINVAL');\n  }\n\n  if (!module.exports.is_jpeg(jpeg_bin)) {\n    throw error('Unknown file format', 'ENOTJPEG');\n  }\n\n  var offset = 0, length = jpeg_bin.length, inside_scan = false;\n\n  for (;;) {\n    var segment_code, segment_length;\n\n    if (offset + 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n    var byte1 = jpeg_bin[offset];\n    var byte2 = jpeg_bin[offset + 1];\n\n    if (byte1 === 0xFF && byte2 === 0xFF) {\n      // padding\n      segment_code = 0xFF;\n      segment_length = 1;\n\n    } else if (byte1 === 0xFF && byte2 !== 0) {\n      // marker\n      segment_code = byte2;\n      segment_length = 2;\n\n      if ((0xD0 <= segment_code && segment_code <= 0xD9) || segment_code === 0x01) ; else {\n        if (offset + 3 >= length) throw error('Unexpected EOF', 'EBADDATA');\n        segment_length += jpeg_bin[offset + 2] * 0x100 + jpeg_bin[offset + 3];\n        if (segment_length < 2) throw error('Invalid segment length', 'EBADDATA');\n        if (offset + segment_length - 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n      }\n\n      if (inside_scan) {\n        if (segment_code >= 0xD0 && segment_code <= 0xD7) ; else {\n          inside_scan = false;\n        }\n      }\n\n      if (segment_code === 0xDA /* SOS */) inside_scan = true;\n    } else if (inside_scan) {\n      // entropy-encoded segment\n      for (var pos = offset + 1; ; pos++) {\n        // scan until we find FF\n        if (pos >= length) throw error('Unexpected EOF', 'EBADDATA');\n        if (jpeg_bin[pos] === 0xFF) {\n          if (pos + 1 >= length) throw error('Unexpected EOF', 'EBADDATA');\n          if (jpeg_bin[pos + 1] !== 0) {\n            segment_code = 0;\n            segment_length = pos - offset;\n            break;\n          }\n        }\n      }\n    } else {\n      throw error('Unexpected byte at segment start: ' + to_hex(byte1) +\n        ' (offset ' + to_hex(offset) + ')', 'EBADDATA');\n    }\n\n    if (on_segment({ code: segment_code, offset: offset, length: segment_length }) === false) break;\n    if (segment_code === 0xD9 /* EOI */) break;\n    offset += segment_length;\n  }\n};\n\n\n// Replace or remove segments in the given JPEG image\n//\n// Input:\n//  - jpeg_bin:   Uint8Array - jpeg file\n//  - on_segment: Function - callback executed on each JPEG marker segment\n//    - segment:  Object\n//      - code:   Number - marker type (2nd byte, e.g. 0xE0 for APP0)\n//      - offset: Number - offset of the first byte (0xFF) relative to `jpeg_bin` start\n//      - length: Number - length of the entire marker segment including first two bytes and length\n//        - 2 for standalone markers\n//        - 4+length for markers with data\n//\n// `on_segment` function should return one of the following:\n//  - `false`        - segment is removed from the output\n//  - Uint8Array     - segment is replaced with the new data\n//  - [ Uint8Array ] - segment is replaced with the new data\n//  - anything else  - segment is copied to the output as is\n//\n// Any data after `EOI` (0xFFD9) marker is removed.\n//\nmodule.exports.jpeg_segments_filter = function (jpeg_bin, on_segment) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_segment !== 'function') {\n    throw error('Invalid argument (on_segment), Function expected', 'EINVAL');\n  }\n\n  var ranges = [];\n  var out_length = 0;\n\n  module.exports.jpeg_segments_each(jpeg_bin, function (segment) {\n    var new_segment = on_segment(segment);\n\n    if (is_uint8array(new_segment)) {\n      ranges.push({ data: new_segment });\n      out_length += new_segment.length;\n    } else if (Array.isArray(new_segment)) {\n      new_segment.filter(is_uint8array).forEach(function (s) {\n        ranges.push({ data: s });\n        out_length += s.length;\n      });\n    } else if (new_segment !== false) {\n      var new_range = { start: segment.offset, end: segment.offset + segment.length };\n\n      if (ranges.length > 0 && ranges[ranges.length - 1].end === new_range.start) {\n        ranges[ranges.length - 1].end = new_range.end;\n      } else {\n        ranges.push(new_range);\n      }\n\n      out_length += segment.length;\n    }\n  });\n\n  var result = new Uint8Array(out_length);\n  var offset = 0;\n\n  ranges.forEach(function (range) {\n    var data = range.data || jpeg_bin.subarray(range.start, range.end);\n    result.set(data, offset);\n    offset += data.length;\n  });\n\n  return result;\n};\n\n\n// Call an iterator on each Exif entry in the given JPEG image\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//  - on_entry: Function - callback executed on each Exif entry\n//    - entry:  Object\n//      - is_big_endian:  Boolean - whether Exif uses big or little endian byte alignment\n//      - ifd:            Number  - IFD identifier (0 for IFD0, 1 for IFD1, 0x8769 for SubIFD,\n//                                 0x8825 for GPS Info, 0xA005 for Interop IFD)\n//      - tag:            Number  - exif entry tag (0x0110 - camera name, 0x0112 - orientation, etc. - see Exif spec)\n//      - format:         Number  - exif entry format (1 - byte, 2 - ascii, 3 - short, etc. - see Exif spec)\n//      - count:          Number  - number of components of the given format inside data\n//                                 (usually 1, or string length for ascii format)\n//      - entry_offset:   Number  - start of Exif entry (entry length is always 12, so not included)\n//      - data_offset:    Number  - start of data attached to Exif entry (will overlap with entry if length <= 4)\n//      - data_length:    Number  - length of data attached to Exif entry\n//      - value:          Array|String|Null - our best attempt at parsing data (not all formats supported right now)\n//      - is_subifd_link: Boolean - whether this entry is recognized to be a link to subifd (can't filter these out)\n//\n// Iteration stops early if iterator returns `false`.\n//\n// If Exif wasn't found anywhere (before start of the image data, SOS),\n// iterator is never executed.\n//\nmodule.exports.jpeg_exif_tags_each = function (jpeg_bin, on_exif_entry) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_exif_entry !== 'function') {\n    throw error('Invalid argument (on_exif_entry), Function expected', 'EINVAL');\n  }\n\n  /* eslint-disable consistent-return */\n  module.exports.jpeg_segments_each(jpeg_bin, function (segment) {\n    if (segment.code === 0xDA /* SOS */) return false;\n\n    // look for APP1 segment and compare header with 'Exif\\0\\0'\n    if (segment.code === 0xE1 && segment.length >= 10 &&\n        jpeg_bin[segment.offset + 4] === 0x45 && jpeg_bin[segment.offset + 5] === 0x78 &&\n        jpeg_bin[segment.offset + 6] === 0x69 && jpeg_bin[segment.offset + 7] === 0x66 &&\n        jpeg_bin[segment.offset + 8] === 0x00 && jpeg_bin[segment.offset + 9] === 0x00) {\n\n      new ExifParser(jpeg_bin, segment.offset + 10, segment.offset + segment.length).each(on_exif_entry);\n      return false;\n    }\n  });\n};\n\n\n// Remove Exif entries in the given JPEG image\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//  - on_entry: Function - callback executed on each Exif entry\n//    - entry:  Object\n//      - is_big_endian:  Boolean - whether Exif uses big or little endian byte alignment\n//      - ifd:            Number  - IFD identifier (0 for IFD0, 1 for IFD1, 0x8769 for SubIFD,\n//                                  0x8825 for GPS Info, 0xA005 for Interop IFD)\n//      - tag:            Number  - exif entry tag (0x0110 - camera name, 0x0112 - orientation, etc. - see Exif spec)\n//      - format:         Number  - exif entry format (1 - byte, 2 - ascii, 3 - short, etc. - see Exif spec)\n//      - count:          Number  - number of components of the given format inside data\n//                                  (usually 1, or string length for ascii format)\n//      - entry_offset:   Number  - start of Exif entry (entry length is always 12, so not included)\n//      - data_offset:    Number  - start of data attached to Exif entry (will overlap with entry if length <= 4)\n//      - data_length:    Number  - length of data attached to Exif entry\n//      - value:          Array|String|Null - our best attempt at parsing data (not all formats supported right now)\n//      - is_subifd_link: Boolean - whether this entry is recognized to be a link to subifd (can't filter these out)\n//\n// This function removes following from Exif:\n//  - all entries where iterator returned false (except subifd links which are mandatory)\n//  - IFD1 and thumbnail image (the purpose of this function is to reduce file size,\n//    so thumbnail is usually the first thing to go)\n//  - all other data that isn't in IFD0, SubIFD, GPSIFD, InteropIFD\n//    (theoretically possible proprietary extensions, I haven't seen any of these yet)\n//\n// Changing data inside Exif entries is NOT supported yet (modifying `entry` object inside callback may break stuff).\n//\n// If Exif wasn't found anywhere (before start of the image data, SOS),\n// iterator is never executed, and original JPEG is returned as is.\n//\nmodule.exports.jpeg_exif_tags_filter = function (jpeg_bin, on_exif_entry) {\n  if (!is_uint8array(jpeg_bin)) {\n    throw error('Invalid argument (jpeg_bin), Uint8Array expected', 'EINVAL');\n  }\n\n  if (typeof on_exif_entry !== 'function') {\n    throw error('Invalid argument (on_exif_entry), Function expected', 'EINVAL');\n  }\n\n  var stop_search = false;\n\n  return module.exports.jpeg_segments_filter(jpeg_bin, function (segment) {\n    if (stop_search) return;\n    if (segment.code === 0xDA /* SOS */) stop_search = true;\n\n    // look for APP1 segment and compare header with 'Exif\\0\\0'\n    if (segment.code === 0xE1 && segment.length >= 10 &&\n        jpeg_bin[segment.offset + 4] === 0x45 && jpeg_bin[segment.offset + 5] === 0x78 &&\n        jpeg_bin[segment.offset + 6] === 0x69 && jpeg_bin[segment.offset + 7] === 0x66 &&\n        jpeg_bin[segment.offset + 8] === 0x00 && jpeg_bin[segment.offset + 9] === 0x00) {\n\n      var new_exif = new ExifParser(jpeg_bin, segment.offset + 10, segment.offset + segment.length)\n        .filter(on_exif_entry);\n      if (!new_exif) return false;\n\n      var header = new Uint8Array(10);\n\n      header.set(jpeg_bin.slice(segment.offset, segment.offset + 10));\n      header[2] = ((new_exif.length + 8) >>> 8) & 0xFF;\n      header[3] = (new_exif.length + 8) & 0xFF;\n\n      stop_search = true;\n      return [ header, new_exif ];\n    }\n  });\n};\n\n\n// Inserts a custom comment marker segment into JPEG file.\n//\n// Input:\n//  - jpeg_bin: Uint8Array - jpeg file\n//  - comment:  String\n//\n// Comment is inserted after first two bytes (FFD8, SOI).\n//\n// If JFIF (APP0) marker exists immediately after SOI (as mandated by the JFIF\n// spec), we insert comment after it instead.\n//\nmodule.exports.jpeg_add_comment = function (jpeg_bin, comment) {\n  var comment_inserted = false, segment_count = 0;\n\n  return module.exports.jpeg_segments_filter(jpeg_bin, function (segment) {\n    segment_count++;\n    if (segment_count === 1 && segment.code === 0xD8 /* SOI  */) return;\n    if (segment_count === 2 && segment.code === 0xE0 /* APP0 */) return;\n\n    if (comment_inserted) return;\n    comment = utf8_encode(comment);\n\n    // comment segment\n    var csegment = new Uint8Array(5 + comment.length);\n    var offset = 0;\n\n    csegment[offset++] = 0xFF;\n    csegment[offset++] = 0xFE;\n    csegment[offset++] = ((comment.length + 3) >>> 8) & 0xFF;\n    csegment[offset++] = (comment.length + 3) & 0xFF;\n\n    comment.split('').forEach(function (c) {\n      csegment[offset++] = c.charCodeAt(0) & 0xFF;\n    });\n\n    csegment[offset++] = 0;\n    comment_inserted = true;\n\n    return [ csegment, jpeg_bin.subarray(segment.offset, segment.offset + segment.length) ];\n  });\n};\n});\n\nfunction jpeg_patch_exif(env) {\n  return this._getUint8Array(env.blob).then(function (data) {\n    env.is_jpeg = image_traverse.is_jpeg(data);\n\n    if (!env.is_jpeg) return Promise.resolve(env);\n\n    env.orig_blob = env.blob;\n\n    try {\n      var exif_is_big_endian, orientation_offset;\n\n      /* eslint-disable consistent-return */\n      image_traverse.jpeg_exif_tags_each(data, function (entry) {\n        if (entry.ifd === 0 && entry.tag === 0x112 && Array.isArray(entry.value)) {\n          env.orientation    = entry.value[0] || 1;\n          exif_is_big_endian = entry.is_big_endian;\n          orientation_offset = entry.data_offset;\n          return false;\n        }\n      });\n\n      if (orientation_offset) {\n        var orientation_patch = exif_is_big_endian ?\n          new Uint8Array([ 0, 1 ]) :\n          new Uint8Array([ 1, 0 ]);\n\n        env.blob = new Blob([\n          data.slice(0, orientation_offset),\n          orientation_patch,\n          data.slice(orientation_offset + 2)\n        ], { type: 'image/jpeg' });\n      }\n    } catch (_) {}\n\n    return env;\n  });\n}\n\n\nfunction jpeg_rotate_canvas(env) {\n  if (!env.is_jpeg) return Promise.resolve(env);\n\n  var orientation = env.orientation - 1;\n  if (!orientation) return Promise.resolve(env);\n\n  var canvas;\n\n  if (orientation & 4) {\n    canvas = this.pica.options.createCanvas(env.out_canvas.height, env.out_canvas.width);\n  } else {\n    canvas = this.pica.options.createCanvas(env.out_canvas.width, env.out_canvas.height);\n  }\n\n  var ctx = canvas.getContext('2d');\n\n  ctx.save();\n\n  if (orientation & 1) ctx.transform(-1, 0, 0, 1, canvas.width, 0);\n  if (orientation & 2) ctx.transform(-1, 0, 0, -1, canvas.width, canvas.height);\n  if (orientation & 4) ctx.transform(0, 1, 1, 0, 0, 0);\n\n  ctx.drawImage(env.out_canvas, 0, 0);\n  ctx.restore();\n\n  // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n  env.out_canvas.width = env.out_canvas.height = 0;\n\n  env.out_canvas = canvas;\n\n  return Promise.resolve(env);\n}\n\n\nfunction jpeg_attach_orig_segments(env) {\n  if (!env.is_jpeg) return Promise.resolve(env);\n\n  return Promise.all([\n    this._getUint8Array(env.blob),\n    this._getUint8Array(env.out_blob)\n  ]).then(function (res) {\n    var data = res[0];\n    var data_out = res[1];\n\n    if (!image_traverse.is_jpeg(data)) return Promise.resolve(env);\n\n    var segments = [];\n\n    image_traverse.jpeg_segments_each(data, function (segment) {\n      if (segment.code === 0xDA /* SOS */) return false;\n      segments.push(segment);\n    });\n\n    segments = segments\n      .filter(function (segment) {\n        // Drop ICC_PROFILE\n        //\n        if (segment.code === 0xE2) return false;\n\n        // Keep all APPn segments excluding APP2 (ICC_PROFILE),\n        // remove others because most of them depend on image data (DCT and such).\n        //\n        // APP0 - JFIF, APP1 - Exif, the rest are photoshop metadata and such\n        //\n        // See full list at https://www.w3.org/Graphics/JPEG/itu-t81.pdf (table B.1 on page 32)\n        //\n        if (segment.code >= 0xE0 && segment.code < 0xF0) return true;\n\n        // Keep comments\n        //\n        if (segment.code === 0xFE) return true;\n\n        return false;\n      })\n      .map(function (segment) {\n        return data.slice(segment.offset, segment.offset + segment.length);\n      });\n\n    env.out_blob = new Blob(\n      // intentionally omitting expected JFIF segment (offset 2 to 20)\n      [ data_out.slice(0, 2) ].concat(segments).concat([ data_out.slice(20) ]),\n      { type: 'image/jpeg' }\n    );\n\n    return env;\n  });\n}\n\n\nfunction assign(reducer) {\n  reducer.before('_blob_to_image', jpeg_patch_exif);\n  reducer.after('_transform',      jpeg_rotate_canvas);\n  reducer.after('_create_blob',    jpeg_attach_orig_segments);\n}\n\n\nvar jpeg_patch_exif_1 = jpeg_patch_exif;\nvar jpeg_rotate_canvas_1 = jpeg_rotate_canvas;\nvar jpeg_attach_orig_segments_1 = jpeg_attach_orig_segments;\nvar assign_1 = assign;\n\nvar jpeg_plugins = {\n\tjpeg_patch_exif: jpeg_patch_exif_1,\n\tjpeg_rotate_canvas: jpeg_rotate_canvas_1,\n\tjpeg_attach_orig_segments: jpeg_attach_orig_segments_1,\n\tassign: assign_1\n};\n\nfunction ImageBlobReduce(options) {\n  if (!(this instanceof ImageBlobReduce)) return new ImageBlobReduce(options);\n\n  options = options || {};\n\n  this.pica = options.pica || pica({});\n  this.initialized = false;\n\n  this.utils = utils;\n}\n\n\nImageBlobReduce.prototype.use = function (plugin /*, params, ... */) {\n  var args = [ this ].concat(Array.prototype.slice.call(arguments, 1));\n  plugin.apply(plugin, args);\n  return this;\n};\n\n\nImageBlobReduce.prototype.init = function () {\n  this.use(jpeg_plugins.assign);\n};\n\n\nImageBlobReduce.prototype.toBlob = function (blob, options) {\n  var opts = utils.assign({ max: Infinity }, options);\n  var env = {\n    blob: blob,\n    opts: opts\n  };\n\n  if (!this.initialized) {\n    this.init();\n    this.initialized = true;\n  }\n\n  return Promise.resolve(env)\n    .then(this._blob_to_image)\n    .then(this._calculate_size)\n    .then(this._transform)\n    .then(this._cleanup)\n    .then(this._create_blob)\n    .then(function (_env) {\n      // Safari 12 workaround\n      // https://github.com/nodeca/pica/issues/199\n      _env.out_canvas.width = _env.out_canvas.height = 0;\n\n      return _env.out_blob;\n    });\n};\n\n\nImageBlobReduce.prototype.toCanvas = function (blob, options) {\n  var opts = utils.assign({ max: Infinity }, options);\n  var env = {\n    blob: blob,\n    opts: opts\n  };\n\n  if (!this.initialized) {\n    this.init();\n    this.initialized = true;\n  }\n\n  return Promise.resolve(env)\n    .then(this._blob_to_image)\n    .then(this._calculate_size)\n    .then(this._transform)\n    .then(this._cleanup)\n    .then(function (_env) { return _env.out_canvas; });\n};\n\n\nImageBlobReduce.prototype.before = function (method_name, fn) {\n  if (!this[method_name]) throw new Error('Method \"' + method_name + '\" does not exist');\n  if (typeof fn !== 'function') throw new Error('Invalid argument \"fn\", function expected');\n\n  var old_fn = this[method_name];\n  var self = this;\n\n  this[method_name] = function (env) {\n    return fn.call(self, env).then(function (_env) {\n      return old_fn.call(self, _env);\n    });\n  };\n\n  return this;\n};\n\n\nImageBlobReduce.prototype.after = function (method_name, fn) {\n  if (!this[method_name]) throw new Error('Method \"' + method_name + '\" does not exist');\n  if (typeof fn !== 'function') throw new Error('Invalid argument \"fn\", function expected');\n\n  var old_fn = this[method_name];\n  var self = this;\n\n  this[method_name] = function (env) {\n    return old_fn.call(self, env).then(function (_env) {\n      return fn.call(self, _env);\n    });\n  };\n\n  return this;\n};\n\n\nImageBlobReduce.prototype._blob_to_image = function (env) {\n  var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n  env.image = document.createElement('img');\n  env.image_url = URL.createObjectURL(env.blob);\n  env.image.src = env.image_url;\n\n  return new Promise(function (resolve, reject) {\n    env.image.onerror = function () { reject(new Error('ImageBlobReduce: failed to create Image() from blob')); };\n    env.image.onload = function () { resolve(env); };\n  });\n};\n\n\nImageBlobReduce.prototype._calculate_size = function (env) {\n  //\n  // Note, if your need not \"symmetric\" resize logic, you MUST check\n  // `env.orientation` (set by plugins) and swap width/height appropriately.\n  //\n  var scale_factor = env.opts.max / Math.max(env.image.width, env.image.height);\n\n  if (scale_factor > 1) scale_factor = 1;\n\n  env.transform_width = Math.max(Math.round(env.image.width * scale_factor), 1);\n  env.transform_height = Math.max(Math.round(env.image.height * scale_factor), 1);\n\n  // Info for user plugins, to check if scaling applied\n  env.scale_factor = scale_factor;\n\n  return Promise.resolve(env);\n};\n\n\nImageBlobReduce.prototype._transform = function (env) {\n  env.out_canvas = this.pica.options.createCanvas(env.transform_width, env.transform_height);\n\n  // Dim env temporary vars to prohibit use and avoid confusion when orientation\n  // changed. You should take real size from canvas.\n  env.transform_width = null;\n  env.transform_height = null;\n\n  // By default use alpha for png only\n  var pica_opts = { alpha: env.blob.type === 'image/png' };\n\n  // Extract pica options if been passed\n  this.utils.assign(pica_opts, this.utils.pick_pica_resize_options(env.opts));\n\n  return this.pica\n    .resize(env.image, env.out_canvas, pica_opts)\n    .then(function () { return env; });\n};\n\n\nImageBlobReduce.prototype._cleanup = function (env) {\n  env.image.src = '';\n  env.image = null;\n\n  var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n  if (URL.revokeObjectURL) URL.revokeObjectURL(env.image_url);\n\n  env.image_url = null;\n\n  return Promise.resolve(env);\n};\n\n\nImageBlobReduce.prototype._create_blob = function (env) {\n  return this.pica.toBlob(env.out_canvas, env.blob.type)\n    .then(function (blob) {\n      env.out_blob = blob;\n      return env;\n    });\n};\n\n\nImageBlobReduce.prototype._getUint8Array = function (blob) {\n  if (blob.arrayBuffer) {\n    return blob.arrayBuffer().then(function (buf) {\n      return new Uint8Array(buf);\n    });\n  }\n\n  return new Promise(function (resolve, reject) {\n    var fr = new FileReader();\n\n    fr.readAsArrayBuffer(blob);\n\n    fr.onload = function () { resolve(new Uint8Array(fr.result)); };\n    fr.onerror = function () {\n      reject(new Error('ImageBlobReduce: failed to load data from input blob'));\n      fr.abort();\n    };\n    fr.onabort = function () {\n      reject(new Error('ImageBlobReduce: failed to load data from input blob (aborted)'));\n    };\n  });\n};\n\n\nImageBlobReduce.pica = pica;\n\nvar imageBlobReduce = ImageBlobReduce;\n\nexport default imageBlobReduce;\n"],"names":["assign$1","to","from","s","key","pick","props","pick_pica_resize_options","pick_1","pick_pica_resize_options_1","utils","createCommonjsModule","fn","module","commonjsRequire","target","pica","exports","f","r","e","n","t","o","i","c","u","a","p","_dereq_","inherits","Multimath","mm_unsharp_mask","mm_resize","MathLib","requested_features","__requested_features","features","options","cache","result","clampTo8","convolveHorizontally","src","dest","srcW","srcH","destW","filters","g","b","filterPtr","filterShift","filterSize","srcPtr","srcY","destX","filterVal","srcOffset","destOffset","convolveVertically","createFilters","resetAlpha","dst","width","height","ptr","len","destH","scaleX","scaleY","offsetX","offsetY","quality","alpha","filtersX","filtersY","tmp","FILTER_INFO","FIXED_FRAC_BITS","toFixedPoint","num","srcSize","destSize","scale","offset","filterFunction","scaleInverted","scaleClamped","srcWindow","destPixel","srcPixel","srcFirst","srcLast","filterElementSize","floatFilter","fxpFilter","total","pxl","idx","floatVal","filterTotal","leftNotEmpty","rightNotEmpty","maxFilterElementSize","packedFilter","packedFilterPtr","slowCopy","x","xpi","asUint8Array","IS_LE","copyInt16asLE","target_offset","data","src_offset","tmp_offset","filtersX_offset","filtersY_offset","alloc_bytes","instance","mem","mem32","src32","dest32","glur_mono16","hsv_v16","img","size","out","max","amount","radius","threshold","v1","v2","vmul","diff","iTimes4","brightness","blured","amountFp","thresholdFp","pixels","img_bytes_cnt","hsv_bytes_cnt","blur_bytes_cnt","blur_line_byte_cnt","blur_coeffs_byte_cnt","img_offset","hsv_offset","blur_offset","blur_tmp_offset","blur_line_offset","blur_coeffs_offset","img32","GC_INTERVAL","Pool","create","idle","_this","resource","_this2","_this3","now","MIN_INNER_TILE_SIZE","fromWidth","fromHeight","toWidth","toHeight","srcTileSize","destTileBorder","minScale","stageCount","PIXEL_EPSILON","pixelFloor","nearest","pixelCeil","innerTileWidth","innerTileHeight","y","innerX","innerY","toTileWidth","toTileHeight","tiles","tile","objClass","obj","element","cname","concurrency","active","queue","roll","resolve","reject","err","createCanvas","bitmap","status","workerPayload","self","canvas","ctx","code","w","ev","usable","d","image","mathLib","tileOpts","returnBitmap","toImageData","_canvas","_ctx","a0","a1","a2","a3","b1","b2","left_corner","right_corner","gaussCoef","sigma","g1","g2","k","convolveMono16","line","coeff","prev_src","curr_src","curr_out","prev_out","prev_prev_out","src_index","out_index","line_index","j","coeff_a0","coeff_a1","coeff_b1","coeff_b2","blurMono16","tmp_line","ctor","superCtor","TempCtor","assign","base64decode","hasWebAssembly","DEFAULT_OPTIONS","MultiMath","opts","name","m","bytes","mem_size","memsize","env_extra","env_base","number","base","reminder","BASE64_MAP","str","input","bits","tailbits","wa","bin","getOwnPropertySymbols","hasOwnProperty","propIsEnumerable","toObject","val","shouldUseNative","test1","test2","order2","test3","letter","source","symbols","bundleFn","sources","stringify","wkey","cacheKeys","l","exp","wcache","skey","scache","workerSources","resolveSources","depPath","depKey","URL","blob","workerUrl","worker","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","minLen","_arrayLikeToArray","arr2","_i","_arr","_n","_d","_s","_e","webworkify","createStages","createRegions","singletones","NEED_SAFARI_FIX","DEFAULT_PICA_OPTS","tmpCanvas","DEFAULT_RESIZE_OPTS","CAN_NEW_IMAGE_DATA","CAN_CREATE_IMAGE_BITMAP","CAN_USE_CANVAS_GET_IMAGE_DATA","CAN_USE_OFFSCREEN_CANVAS","CAN_USE_CIB_REGION_FOR_IMAGE","workerFabric","url","Pica","limiter_key","wkr","wpool_key","initMath","mathlib","checkCibResize","checkOffscreenCanvas","checkCibRegion","transfer","stageEnv","extractTo","tmpCtx","processTile","imageBitmap","regions","jobs","cleanup","stages","_this4","_stages$shift","_stages$shift2","isLastStage","res","_this5","toCtx","iData","_this6","DEST_TILE_BORDER","_this7","mimeType","asString","asBuffer","image_traverse","error","message","to_hex","utf8_encode","utf8_decode","is_uint8array","ExifParser","jpeg_bin","exif_start","exif_end","sig","on_entry","ifds","entry","length","ifd_no","ifd_start","ifd_end","entry_offset","next_ifd","value","ifd","tag","format","v","entry_count","count","comp_length","data_length","data_offset","is_subifd_link","comp_offset","item","on_segment","inside_scan","segment_code","segment_length","byte1","byte2","pos","ranges","out_length","segment","new_segment","new_range","range","on_exif_entry","stop_search","new_exif","header","comment","comment_inserted","segment_count","csegment","jpeg_patch_exif","env","exif_is_big_endian","orientation_offset","orientation_patch","jpeg_rotate_canvas","orientation","jpeg_attach_orig_segments","data_out","segments","reducer","assign_1","jpeg_plugins","ImageBlobReduce","plugin","args","_env","method_name","old_fn","scale_factor","pica_opts","buf","fr","imageBlobReduce"],"mappings":"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","x_google_ignoreList":[0]}