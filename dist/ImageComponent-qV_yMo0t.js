"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index-B68OGEr0.js"),F=require("./LexicalNestedComposer.prod-CsSHcpTz.js"),o=require("react"),K=require("./ImageResizer-BVftMirr.js"),U="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e",M=new Map,H=e.oe("RIGHT_CLICK_IMAGE_COMMAND");function W(c){let l=M.get(c);if(typeof l=="boolean")return l;throw l||(l=new Promise(n=>{const d=new Image;d.src=c,d.onload=()=>n(!1),d.onerror=()=>n(!0)}).then(n=>(M.set(c,n),n)),M.set(c,l),l)}function J(c){return c.toLowerCase().endsWith(".svg")}function Q({altText:c,className:l,imageRef:n,src:d,width:w,height:I,maxWidth:j,onError:h}){const[i,C]=o.useState(null),g=J(d);o.useEffect(()=>{if(n.current&&g){const{naturalWidth:m,naturalHeight:u}=n.current;C({height:u,width:m})}},[n,g]);const v=W(d);if(o.useEffect(()=>{v&&h()},[v,h]),v)return e.jsxRuntimeExports.jsx(G,{});const p=(()=>{if(!g)return{height:I,maxWidth:j,width:w};const m=(i==null?void 0:i.width)||200,u=(i==null?void 0:i.height)||200;let x=m,E=u;if(x>j){const R=j/x;x=j,E=Math.round(E*R)}const t=500;if(E>t){const R=t/E;E=t,x=Math.round(x*R)}return{height:E,maxWidth:j,width:x}})();return e.jsxRuntimeExports.jsx("img",{className:l||void 0,src:d,alt:c,ref:n,style:p,onError:h,draggable:"false",onLoad:m=>{if(g){const u=m.currentTarget;C({height:u.naturalHeight,width:u.naturalWidth})}}})}function G(){return e.jsxRuntimeExports.jsx("img",{src:U,style:{height:200,opacity:.2,width:200},draggable:"false",alt:"Broken image"})}function X({src:c,altText:l,nodeKey:n,width:d,height:w,maxWidth:I,resizable:j,showCaption:h,caption:i,captionsEnabled:C}){const g=o.useRef(null),v=o.useRef(null),[f,p,m]=e.u$1(n),[u,x]=o.useState(!1),{isCollabActive:E}=e.l$1(),[t]=e.o(),[R,_]=o.useState(null),y=o.useRef(null),[L,z]=o.useState(!1),D=e.a$1(),$=o.useCallback(s=>{const r=e.Nr(),a=v.current;if(f&&e.ur(r)&&r.getNodes().length===1){if(h)return e.ys(null),s.preventDefault(),i.focus(),!0;if(a!==null&&a!==document.activeElement)return s.preventDefault(),a.focus(),!0}return!1},[i,f,h]),V=o.useCallback(s=>y.current===i||v.current===s.target?(e.ys(null),t.update(()=>{p(!0);const r=t.getRootElement();r!==null&&r.focus()}),!0):!1,[i,t,p]),b=o.useCallback(s=>{const r=s;return u?!0:r.target===g.current?(r.shiftKey?p(!f):(m(),p(!0)),!0):!1},[u,f,p,m]),N=o.useCallback(s=>{t.getEditorState().read(()=>{const r=e.Nr();s.target.tagName==="IMG"&&e.cr(r)&&r.getNodes().length===1&&t.dispatchCommand(H,s)})},[t]);o.useEffect(()=>{const s=t.getRootElement(),r=e.j(t.registerUpdateListener(({editorState:a})=>{const S=a.read(()=>e.Nr());e.ur(S)?_(S):_(null)}),t.registerCommand(e.le,(a,S)=>(y.current=S,!1),e.Ii),t.registerCommand(e.ae,b,e.Ii),t.registerCommand(H,b,e.Ii),t.registerCommand(e.Be,a=>a.target===g.current?(a.preventDefault(),!0):!1,e.Ii),t.registerCommand(e.Ee,$,e.Ii),t.registerCommand(e.Oe,V,e.Ii));return s==null||s.addEventListener("contextmenu",N),()=>{r(),s==null||s.removeEventListener("contextmenu",N)}},[m,t,u,f,n,$,V,b,N,p]);const T=()=>{t.update(()=>{const s=e.as(n);e.$isImageNode(s)&&s.setShowCaption(!0)})},A=(s,r)=>{setTimeout(()=>{x(!1)},200),t.update(()=>{const a=e.as(n);e.$isImageNode(a)&&a.setWidthAndHeight(s,r)})},P=()=>{x(!0)},{historyState:B}=e.useSharedHistoryContext(),{settings:{showNestedEditorTreeView:O}}=e.useSettings(),q=f&&e.ur(R)&&!u,k=(f||u)&&D;return e.jsxRuntimeExports.jsx(o.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("div",{draggable:q,children:L?e.jsxRuntimeExports.jsx(G,{}):e.jsxRuntimeExports.jsx(Q,{className:k?`focused ${e.ur(R)?"draggable":""}`:null,src:c,altText:l,imageRef:g,width:d,height:w,maxWidth:I,onError:()=>z(!0)})}),h&&e.jsxRuntimeExports.jsx("div",{className:"image-caption-container",children:e.jsxRuntimeExports.jsxs(F.f,{initialEditor:i,children:[e.jsxRuntimeExports.jsx(e.o$1,{}),e.jsxRuntimeExports.jsx(e.MentionsPlugin,{}),e.jsxRuntimeExports.jsx(e.LinkPlugin,{}),e.jsxRuntimeExports.jsx(e.EmojisPlugin,{}),e.jsxRuntimeExports.jsx(e.c$1,{}),e.jsxRuntimeExports.jsx(e.KeywordsPlugin,{}),E?e.jsxRuntimeExports.jsx(e._$1,{id:i.getKey(),providerFactory:e.createWebsocketProvider,shouldBootstrap:!0}):e.jsxRuntimeExports.jsx(e.a$3,{externalHistoryState:B}),e.jsxRuntimeExports.jsx(e.h$1,{contentEditable:e.jsxRuntimeExports.jsx(e.LexicalContentEditable,{placeholder:"Enter a caption...",placeholderClassName:"ImageNode__placeholder",className:"ImageNode__contentEditable"}),ErrorBoundary:e.a$2}),O===!0?e.jsxRuntimeExports.jsx(e.TreeViewPlugin,{}):null]})}),j&&e.ur(R)&&k&&e.jsxRuntimeExports.jsx(K.ImageResizer,{showCaption:h,setShowCaption:T,editor:t,buttonRef:v,imageRef:g,maxWidth:I,onResizeStart:P,onResizeEnd:A,captionsEnabled:!L&&C})]})})}exports.RIGHT_CLICK_IMAGE_COMMAND=H;exports.default=X;
//# sourceMappingURL=ImageComponent-qV_yMo0t.js.map
